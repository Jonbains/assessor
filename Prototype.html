<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
    <title>Multi-Sector Assessment Platform - Obsolete</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #141414;
            color: #ffffff;
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            padding-top: 80px;
        }

        /* Mobile Responsive Improvements */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                padding-top: 70px;
            }
            
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
            h3 { font-size: 1.25rem; }
            
            .assessment-grid {
                grid-template-columns: 1fr !important;
            }
            
            .btn {
                min-height: 44px;
                width: 100%;
                margin-bottom: 0.5rem;
            }
            
            .navigation {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .prototype-nav {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .option {
                padding: 1rem;
            }
            
            .email-form .form-row {
                flex-direction: column;
            }
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 300;
            letter-spacing: -0.5px;
        }
        
        .logo span {
            color: #ffff66;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin: 2rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #ffff66;
            transition: width 0.3s ease;
            border-radius: 2px;
        }

        .progress-text {
            text-align: center;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 0.5rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 300;
            margin-bottom: 1rem;
            text-align: center;
            line-height: 1.2;
        }

        h2 {
            font-size: 2rem;
            font-weight: 300;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        h3 {
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 1rem;
            color: #fff;
        }
        h4 {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: #ffff66;
        }

        p {
            font-size: 1.125rem;
            color: rgba(255, 255, 255, 0.7);
            text-align: center;
            margin-bottom: 2rem;
        }

        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Prototype Navigation - Fixed for easy access */
        .prototype-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 10px 20px;
            z-index: 1000;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .prototype-nav h4 {
            color: #ffff66;
            margin-right: 15px;
            font-size: 0.9rem;
            margin-bottom: 0; 
        }
        .prototype-nav .nav-item {
            color: #fff;
            text-decoration: none;
            font-size: 0.8rem;
            padding: 5px 8px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
            transition: all 0.2s ease;
        }
        .prototype-nav .nav-item:hover {
            background: rgba(255,255,102,0.2);
            transform: translateY(-1px);
        }
        .prototype-nav .nav-separator {
            width: 1px;
            height: 20px;
            background: rgba(255,255,255,0.2);
            margin: 0 5px;
        }

        .assessment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .assessment-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .assessment-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: #ffff66;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 255, 102, 0.1);
        }

        .assessment-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: #ffff66;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .assessment-card:hover::before {
            transform: translateX(0);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 0.5rem;
        }

        .card-description {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1rem;
            line-height: 1.6;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .time {
            color: #ffff66;
            font-size: 0.875rem;
        }

        .badge {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .options {
            display: grid;
            gap: 1rem;
        }

        .option {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
            min-height: 60px;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateX(3px);
        }

        .option.selected {
            background: rgba(255, 255, 102, 0.1);
            border-color: #ffff66;
        }

        .option-icon {
            font-size: 2rem;
            width: 60px;
            text-align: center;
            flex-shrink: 0;
        }
        
        .option-content {
            flex: 1;
        }

        .option-title {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
            font-weight: 400;
        }

        .option-description {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.875rem;
        }

        /* Service Selection Styles */
        .services-grid {
            display: grid;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .service-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.2s ease;
        }

        .service-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .service-icon {
            font-size: 1.5rem;
            width: 32px;
            text-align: center;
            flex-shrink: 0;
        }

        .service-content {
            flex: 1;
            min-width: 0;
        }

        .service-name {
            font-size: 1rem;
            font-weight: 400;
            margin-bottom: 0.25rem;
        }

        .service-description {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .slider-container { 
            position: relative;
            height: 20px;
            display: flex;
            align-items: center;
            margin-top: 1rem;
        }
        
        .slider-container input[type="range"] {
            width: 100%; 
            -webkit-appearance: none;
            appearance: none;
            background: transparent;
            cursor: pointer;
        }
        
        .slider-container input[type="range"]::-webkit-slider-runnable-track {
            background: rgba(255,255,255,0.1);
            height: 6px;
            border-radius: 3px;
        }
        
        .slider-container input[type="range"]::-moz-range-track {
            background: rgba(255,255,255,0.1);
            height: 6px;
            border-radius: 3px;
        }
        
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            margin-top: -5px; 
            background-color: #ffff66;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            border: 2px solid #141414;
            cursor: pointer;
        }
        
        .slider-container input[type="range"]::-moz-range-thumb {
            background-color: #ffff66;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            border: 2px solid #141414;
            cursor: pointer;
        }

        .slider-value {
            margin-left: 0.75rem;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.7);
            min-width: 60px;
            text-align: right;
        }

        /* Question Card Styles */
        .question-card { 
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .question-number {
            color: #ffff66;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }
        
        .question-title { 
            font-size: 1.5rem; 
            font-weight: 400;
            margin-bottom: 2rem;
            color: #fff;
            text-align: left;
        }
        
        .question-options {
            display: grid;
            gap: 1rem;
        }
        
        .option-check {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: #ffff66;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .option.selected .option-check {
            background: #ffff66;
            border-color: #ffff66;
            color: #141414;
        }
        
        .option-text {
            font-size: 1.1rem;
            color: rgba(255,255,255,0.9);
        }
        
        .question-insight, .question-benchmark {
            font-size: 0.8rem;
            margin-top: 1rem;
            text-align: left;
        }
        
        .question-insight { 
            color: rgba(255,255,255,0.6);
            font-style: italic;
        }
        
        .question-benchmark { 
            color: #ffff66;
            font-weight: 500;
        }

        .context-badge {
            background: rgba(255, 255, 102, 0.1);
            color: #ffff66;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
            margin-bottom: 2rem;
        }

        .co-creation-highlight {
            background: rgba(255, 255, 102, 0.05);
            border-left: 3px solid #ffff66;
            padding: 1.5rem;
            margin: 2rem 0;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            border-radius: 0 8px 8px 0;
        }
        
        .co-creation-highlight p {
            text-align: left;
            font-size: 0.9rem;
            margin-bottom: 0;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            min-height: 44px;
        }

        .btn-primary {
            background: #ffff66;
            color: #141414;
        }
        .btn-primary:hover {
            background: #ffff33;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 255, 102, 0.3);
        }
        .btn-primary:disabled {
            background: rgba(255, 255, 102, 0.3);
            color: rgba(20, 20, 20, 0.5);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
        }
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }
        
        .btn-skip {
            background: none;
            color: rgba(255,255,255,0.6);
            padding: 0.75rem 0; 
        }
        .btn-skip:hover {
            color: #fff;
        }

        /* Email Gate Styles */
        .email-gate {
            max-width: 500px;
            margin: 2rem auto;
            text-align: center;
        }
        .email-header h2 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        .email-header p {
            font-size: 1.1rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 2.5rem;
        }
        .email-form .form-group {
            position: relative;
            margin-bottom: 1.5rem;
        }
        .email-form .form-input {
            width: 100%;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.2s ease;
        }
        .email-form .form-input:focus {
            outline: none;
            border-color: #ffff66;
            background: rgba(255,255,255,0.07);
        }
        .email-form .form-input:invalid {
            border-color: #ff4444;
        }
        .email-form .form-label {
            position: absolute;
            left: 1rem;
            top: 1rem;
            color: rgba(255,255,255,0.5);
            pointer-events: none;
            transition: all 0.2s ease;
            background: #141414; 
            padding: 0 0.25rem;
        }
        .email-form .form-input:focus + .form-label,
        .email-form .form-input:not(:placeholder-shown) + .form-label {
            top: -0.5rem;
            font-size: 0.75rem;
            color: #ffff66;
        }
        .email-form .form-row {
            display: flex;
            gap: 1rem;
        }
        .email-form .form-row .form-group {
            flex: 1;
        }
        .email-form .consent-group {
            text-align: left;
            margin-bottom: 2rem;
        }
        .email-form .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
        }
        .email-form input[type="checkbox"] {
            display: none;
        }
        .email-form .checkbox-custom {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            margin-right: 0.75rem;
            display: inline-block;
            transition: all 0.2s ease;
            position: relative;
        }
        .email-form input[type="checkbox"]:checked + .checkbox-custom {
            background: #ffff66;
            border-color: #ffff66;
        }
        .email-form input[type="checkbox"]:checked + .checkbox-custom::after {
            content: '✓';
            position: absolute;
            color: #141414;
            font-size: 0.9rem;
            font-weight: bold;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .email-form .cta-button {
            width: 100%;
            padding: 1rem;
            background: #ffff66;
            color: #141414;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .email-form .cta-button:hover {
            background: #ffff33;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 255, 102, 0.3);
        }
        .email-form .privacy-note {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.5);
            margin-top: 1rem;
        }

        /* Results Dashboard & Report Styles */
        .results-dashboard {
            padding: 1rem 0;
        }
        .report-section {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .report-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .report-section h2 {
            font-size: 1.8rem;
            color: #ffff66;
            text-align: left;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255,255,102,0.3);
            padding-bottom: 0.5rem;
        }
        .report-section h3 {
            font-size: 1.3rem;
            color: #fff;
            font-weight: 500;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }
         .report-section p, .report-section li {
            text-align: left;
            font-size: 1rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 0.75rem;
        }
        .report-section ul {
            list-style-position: inside;
            padding-left: 0;
        }
        .report-section li {
            margin-bottom: 0.5rem;
        }
        .report-section strong {
            color: #ffff66;
            font-weight: 500;
        }

        .executive-summary .results-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .executive-summary .results-header {
                flex-direction: row;
                justify-content: space-around;
            }
        }
        
        .score-circle {
            position: relative;
            width: 180px;
            height: 180px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .score-circle svg {
            position: absolute;
            top: 0;
            left: 0;
            transform: rotate(-90deg); 
        }
        .score-value {
            font-size: 3.5rem;
            font-weight: 200;
            color: #ffff66;
            line-height: 1;
        }
        .score-label {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .executive-summary .headline-section h1 {
            font-size: 2rem; 
            margin-bottom: 0.5rem;
        }
        .executive-summary .headline-section .subheadline {
            font-size: 1.1rem;
            color: rgba(255,255,255,0.8);
            max-width: 600px;
            margin: 0 auto 1.5rem auto;
        }
        .executive-summary .key-metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .metric-card {
            background: rgba(255,255,255,0.03);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .metric-card:hover {
            background: rgba(255,255,255,0.05);
            transform: translateY(-2px);
        }
        .metric-card .value {
            font-size: 2rem;
            color: #ffff66;
            font-weight: 300;
            margin-bottom: 0.25rem;
        }
        .metric-card .label {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 0.25rem;
        }
        .metric-card .interpretation {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.6);
        }
        .executive-summary .narrative p {
            font-size: 1.05rem;
            line-height: 1.7;
            margin-bottom: 1rem;
        }

        .readiness-dimensions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        .dimension-card {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 3px solid #ffff66;
            transition: all 0.3s ease;
        }
        .dimension-card:hover {
            background: rgba(255,255,255,0.05);
            transform: translateX(3px);
        }
        .dimension-card .name {
            font-size: 1.2rem;
            font-weight: 500;
            color: #fff;
            margin-bottom: 0.5rem;
        }
        .dimension-card .score {
            font-size: 2.5rem;
            color: #ffff66;
            font-weight: 200;
            margin-bottom: 0.5rem;
        }
        .dimension-card .description {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 1rem;
        }
        .dimension-card .insights-list li {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
            margin-bottom: 0.25rem;
        }

        .recommendation-item {
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        .recommendation-item:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,102,0.3);
        }
        .recommendation-item .title {
            font-size: 1.1rem;
            font-weight: 500;
            color: #ffffaa;
            margin-bottom: 0.5rem;
        }
        .recommendation-item .description {
            font-size: 0.95rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 0.75rem;
        }
        .recommendation-item .details {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
        }
        .recommendation-item .details span {
            margin-right: 1rem;
        }
        .recommendation-item .details strong {
            color: rgba(255,255,255,0.7);
        }

        .roadmap-phase {
            background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            padding-left: 3rem;
        }
        .roadmap-phase::before {
            content: '';
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            background: #ffff66;
            border-radius: 50%;
        }
        .roadmap-phase .phase-title {
            font-size: 1.2rem;
            color: #ffff66;
            margin-bottom: 0.5rem;
        }
        .roadmap-phase .phase-duration {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.6);
            margin-bottom: 1rem;
        }

        .valuation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: start;
        }
        
        @media (max-width: 768px) {
            .valuation-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .valuation-card {
            background: rgba(255,255,102,0.05);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }
        .valuation-card .label {
            font-size: 1rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 0.5rem;
        }
        .valuation-card .value {
            font-size: 2.2rem;
            color: #ffff66;
            font-weight: 300;
        }
        .valuation-card .increase {
            font-size: 1.2rem;
            color: #00dd88;
        }
        .valuation-drivers-list li {
            padding-left: 1.5rem;
            position: relative;
        }
        .valuation-drivers-list li::before {
            content: '✓';
            color: #00dd88;
            position: absolute;
            left: 0;
        }

        .next-steps-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        .next-step-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        .next-step-card:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,102,0.3);
            transform: translateY(-2px);
        }
        .next-step-card .title {
            font-size: 1.3rem;
            color: #ffff66;
            margin-bottom: 0.75rem;
        }
        .next-step-card .price {
            font-size: 1rem;
            color: rgba(255,255,255,0.7);
            margin-bottom: 1rem;
        }
        .next-step-card .cta-button {
            margin-top: 1.5rem;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
        }
        .testimonial-quote {
            font-style: italic;
            font-size: 1.05rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 0.5rem;
            padding: 1rem;
            background: rgba(255,255,255,0.02);
            border-left: 3px solid #ffff66;
            border-radius: 4px;
        }
        .testimonial-author {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.7);
            text-align: right;
        }

        /* Loading Spinner */
        .loading-spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(20, 20, 20, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .loading-spinner-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-left-color: #ffff66;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        .loading-text {
            color: #ffff66;
            margin-top: 1rem;
            font-size: 1rem;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Error State */
        .error-message {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid #ff4444;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            color: #ff8888;
            text-align: center;
        }

        /* Progress Save Indicator */
        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 221, 136, 0.9);
            color: #141414;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 1001;
        }
        
        .save-indicator.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Benchmark Indicator */
        .benchmark-indicator {
            background: rgba(255, 255, 102, 0.1);
            border-left: 3px solid #ffff66;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }
        
        .benchmark-indicator .label {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .benchmark-indicator .value {
            font-size: 1.2rem;
            color: #ffff66;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="prototype-nav">
        <h4>Prototype Nav</h4>
        <a class="nav-item" href="#" onclick="event.preventDefault(); window.showScreen('assessment-selection')">1. Type</a>
        <a class="nav-item" href="#" onclick="event.preventDefault(); window.showScreen('sector-selection')">2. Sector</a>
        <a class="nav-item" href="#" onclick="event.preventDefault(); window.showScreen('qualifying-questions')">3. Qualify</a>
        <a class="nav-item" href="#" onclick="event.preventDefault(); window.showScreen('service-selection')">4. Services</a>
        <a class="nav-item" href="#" onclick="event.preventDefault(); window.showScreen('dynamic-questions')">5. Assess</a>
        <a class="nav-item" href="#" onclick="event.preventDefault(); window.showScreen('email-gate')">6. Email</a>
        <div class="nav-separator"></div>
        <a class="nav-item" href="#" onclick="event.preventDefault(); window.showScreen('agency-results')">7a. Agency Results</a>
        <a class="nav-item" href="#" onclick="event.preventDefault(); window.showScreen('inhouse-results')">7b. In-House Results</a>
        <div class="nav-separator"></div>
        <a class="nav-item" href="#" onclick="event.preventDefault(); window.clearProgress()">Clear Progress</a>
    </div>
    
    <div class="loading-spinner-overlay" id="loading-overlay">
        <div class="spinner"></div>
        <p class="loading-text" id="loading-overlay-text">Calculating your results...</p>
    </div>
    
    <div class="save-indicator" id="save-indicator">Progress saved</div>
    
    <div class="container">
        <!-- Screen 1: Assessment Selection -->
        <div class="screen active" id="assessment-selection">
            <div class="header">
                <div class="logo">obsolete<span>.</span></div>
            </div>
            
            <h1>Which best describes your organisation?</h1>
            <p>Choose your assessment to discover how AI could transform your business—without the hype or jargon.</p>
            
            <div class="assessment-grid">
                <div class="assessment-card" onclick="window.selectAssessment('agency')">
                    <div class="card-icon">🎯</div>
                    <h2 class="card-title">Agency</h2>
                    <p class="card-description">Creative, digital, PR, or marketing agencies wondering if AI will eat your lunch—or help you serve a better one.</p>
                    <div class="card-meta">
                        <span class="time">⏱ 8 mins</span>
                        <span class="badge">Most Popular</span>
                    </div>
                </div>
                
                <div class="assessment-card" onclick="window.selectAssessment('inhouse')">
                    <div class="card-icon">📈</div>
                    <h2 class="card-title">In-House Marketing</h2>
                    <p class="card-description">Marketing teams trying to do more with less, while their boss asks "have you tried ChatGPT?"</p>
                    <div class="card-meta">
                        <span class="time">⏱ 7 mins</span>
                        <span class="badge">Quick Wins</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Screen 2: Sector Selection -->
        <div class="screen" id="sector-selection">
            <div class="header">
                <div class="logo">obsolete<span>.</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-bar-sector-selection" style="width: 15%"></div>
                </div>
                <div class="progress-text" id="progress-step-text-sector-selection">Step 2 of 7</div>
            </div>
            
            <h2 id="sector-title">What type of agency are you?</h2>
            <p id="sector-description">We'll tailor your assessment to the unique challenges of your sector.</p>
            
            <div class="options" id="sector-options-container">
                <p style="color: #aaa; font-style: italic;">Sector options will be dynamically loaded here.</p>
            </div>
            
            <div class="navigation">
                <button class="btn btn-secondary" onclick="window.previousScreen()">← Back</button>
                <button class="btn btn-primary" disabled="" id="sector-continue" onclick="window.nextScreen()">Continue</button>
            </div>
        </div>
        
        <!-- Screen 3: Qualifying Questions -->
        <div class="screen" id="qualifying-questions">
            <div class="header">
                <div class="logo">obsolete<span>.</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-bar-qualifying-questions" style="width: 30%"></div>
                </div>
                <div class="progress-text" id="progress-step-text-qualifying-questions">Step 3 of 7</div>
            </div>
            
            <h2>Let's understand your <span id="qualifying-org-type">organisation</span> better</h2>
            <p>These questions help us provide relevant benchmarks and identify your unique opportunities.</p>
            
            <div id="qualifying-questions-container">
                <p style="color: #aaa; font-style: italic;">Qualifying questions will be dynamically loaded here.</p>
            </div>
            
            <div class="co-creation-highlight">
                <p>Why we ask: Understanding your scale and challenges helps us recommend solutions that fit your resources and growth stage. We believe in building capability within your existing team.</p>
            </div>
            
            <div class="navigation">
                <button class="btn btn-secondary" onclick="window.previousScreen()">← Back</button>
                <button class="btn btn-primary" id="qualifying-continue" onclick="window.nextScreen()">Continue</button>
            </div>
        </div>
        
        <!-- Screen 4: Service Selection -->
        <div class="screen" id="service-selection">
            <div class="header">
                <div class="logo">obsolete<span>.</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-bar-service-selection" style="width: 45%"></div>
                </div>
                <div class="progress-text" id="progress-step-text-service-selection">Step 4 of 7</div>
            </div>
            
            <h2 id="service-selection-title">What services do you provide?</h2>
            <p id="service-selection-description">Drag the sliders to show relative importance. Don't worry about exact percentages—we'll figure that out.</p>
            
            <div class="services-grid" id="services-grid-container">
                <p style="color: #aaa; font-style: italic;">Service selection options will be dynamically loaded here.</p>
            </div>
            
            <div class="co-creation-highlight">
                <p>Why we ask: Knowing your core services helps us pinpoint where AI can have the biggest impact on your efficiency and client value.</p>
            </div>
            
            <div class="navigation">
                <button class="btn btn-secondary" onclick="window.previousScreen()">← Back</button>
                <button class="btn btn-primary" id="service-continue" onclick="window.nextScreen()">Continue</button>
            </div>
        </div>
        
        <!-- Screen 5: Dynamic Questions -->
        <div class="screen" id="dynamic-questions">
            <div class="header">
                <div class="logo">obsolete<span>.</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-bar-dynamic-questions" style="width: 60%"></div>
                </div>
                <div class="progress-text" id="progress-step-text-dynamic-questions">Step 5 of 7</div>
            </div>
            
            <div id="dynamic-question-render-area">
                <div class="question-card">
                    <div class="question-number" id="dynamic-question-number">Question X of Y</div>
                    <h3 class="question-title" id="dynamic-question-text">Loading question...</h3>
                    <div class="question-options" id="dynamic-question-options-container">
                        <!-- Options will be loaded here -->
                    </div>
                    <p class="question-insight" id="dynamic-question-insight"></p>
                    <p class="question-benchmark" id="dynamic-question-benchmark"></p>
                </div>
            </div>
            
            <div class="navigation">
                <button class="btn btn-secondary" onclick="window.previousQuestion()">← Back</button>
                <button class="btn btn-skip" onclick="window.skipQuestion()">Skip</button>
                <button class="btn btn-primary" id="dynamic-question-continue" onclick="window.nextQuestion()">Continue</button>
            </div>
        </div>
        
        <!-- Screen 6: Email Gate -->
        <div class="screen" id="email-gate">
            <div class="header">
                <div class="logo">obsolete<span>.</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-bar-email-gate" style="width: 85%"></div>
                </div>
                <div class="progress-text" id="progress-step-text-email-gate">Step 6 of 7</div>
            </div>
            
            <div class="email-gate">
                <div class="email-header">
                    <h2>Almost there!</h2>
                    <p>Get your personalized AI readiness report and transformation roadmap.</p>
                </div>
                
                <form class="email-form" onsubmit="window.submitEmail(event)">
                    <div class="form-group">
                        <input class="form-input" id="email" name="email" placeholder=" " required="" type="email"/>
                        <label class="form-label" for="email">Work Email*</label>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <input class="form-input" id="firstName" name="firstName" placeholder=" " type="text"/>
                            <label class="form-label" for="firstName">First Name</label>
                        </div>
                        <div class="form-group">
                            <input class="form-input" id="lastName" name="lastName" placeholder=" " type="text"/>
                            <label class="form-label" for="lastName">Last Name</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <input class="form-input" id="company" name="company" placeholder=" " type="text"/>
                        <label class="form-label" for="company">Company</label>
                    </div>
                    
                    <div class="form-group">
                        <input class="form-input" id="phone" name="phone" placeholder=" " type="tel"/>
                        <label class="form-label" for="phone">Phone (optional)</label>
                    </div>
                    
                    <div class="consent-group">
                        <label class="checkbox-label">
                            <input id="marketing-consent" name="marketingConsent" type="checkbox"/>
                            <span class="checkbox-custom"></span>
                            <span class="consent-text">I'd like to receive AI transformation insights and tips from Obsolete.</span>
                        </label>
                    </div>
                    
                    <button class="cta-button" type="submit">Get My Results</button>
                    <p class="privacy-note">We respect your privacy. Your data is secure and will never be shared. By submitting, you agree to our Terms and Privacy Policy.</p>
                </form>
            </div>
        </div>
        
        <!-- Screen 7a: Agency Results -->
        <div class="screen" id="agency-results">
            <div class="header">
                <div class="logo">obsolete<span>.</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-bar-agency-results" style="width: 100%"></div>
                </div>
                <div class="progress-text" id="progress-step-text-agency-results">Results Ready!</div>
            </div>
            
            <div class="results-dashboard" id="agency-results-dashboard-container">
                <!-- Comprehensive report will be rendered here by JavaScript -->
                <p style="color: #aaa; font-style: italic;">Generating your agency report...</p>
            </div>
            
            <div class="navigation">
                <button class="btn btn-secondary" onclick="window.startNewAssessment()">Start New Assessment</button>
                <button class="btn btn-primary" onclick="window.bookConsultation('agency')">Book QuickMap.ai Consultation</button>
            </div>
        </div>
        
        <!-- Screen 7b: In-House Results -->
        <div class="screen" id="inhouse-results">
            <div class="header">
                <div class="logo">obsolete<span>.</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill-bar-inhouse-results" style="width: 100%"></div>
                </div>
                <div class="progress-text" id="progress-step-text-inhouse-results">Results Ready!</div>
            </div>
            
            <div class="results-dashboard" id="inhouse-results-dashboard-container">
                <!-- Comprehensive report will be rendered here by JavaScript -->
                <p style="color: #aaa; font-style: italic;">Generating your in-house marketing report...</p>
            </div>
            
            <div class="navigation">
                <button class="btn btn-secondary" onclick="window.startNewAssessment()">Start New Assessment</button>
                <button class="btn btn-primary" onclick="window.bookConsultation('inhouse')">Book QuickMap.ai Consultation</button>
            </div>
        </div>
    </div>

    <script>
        // --- Embedded Data Structures & Classes ---
        
        // AgencyQuestionsConfig (from memory)
        const AgencyQuestionsConfig = {
            metadata: { version: "2.0", type: "agency-transformation", title: "Agency AI Transformation Readiness Assessment", description: "Discover your agency's readiness for AI transformation and unlock hidden valuation potential", estimatedTime: "8-10 minutes", questionCount: { core: 20, perService: 5 } },
            qualifying: [
                { id: "agency_type", question: "Which best describes your agency?", type: "single-select", required: true, options: [ { value: "creative", label: "Creative/Design Agency", icon: "🎨" }, { value: "digital", label: "Digital Marketing Agency", icon: "💻" }, { value: "pr", label: "PR/Communications Agency", icon: "📢" }, { value: "content", label: "Content/Social Agency", icon: "✍️" }, { value: "integrated", label: "Full-Service Agency", icon: "🎯" }, { value: "specialist", label: "Specialist Agency", icon: "🔧" } ] },
                { id: "agency_size", question: "How many people work at your agency?", type: "single-select", required: true, options: [ { value: "1-5", label: "1-5 (Boutique)", score: 1 }, { value: "6-15", label: "6-15 (Small)", score: 2 }, { value: "16-30", label: "16-30 (Mid-size)", score: 3 }, { value: "31-50", label: "31-50 (Growing)", score: 4 }, { value: "50+", label: "50+ (Established)", score: 5 } ] },
                { id: "annual_revenue", question: "What's your approximate annual revenue?", type: "single-select", required: true, valuationWeight: 2.0, options: [ { value: "under-500k", label: "Under £500K", score: 1 }, { value: "500k-1m", label: "£500K - £1M", score: 2 }, { value: "1m-2.5m", label: "£1M - £2.5M", score: 3 }, { value: "2.5m-5m", label: "£2.5M - £5M", score: 4 }, { value: "5m-10m", label: "£5M - £10M", score: 5 }, { value: "10m+", label: "Over £10M", score: 5 } ] }
            ],
            coreQuestions: {
                teamChampions: [ { id: "tc_1", question: "Who in your team gets most excited about trying new tools and tech?", dimension: "transformation", weight: 1.2, valuationCategory: "operational", options: [ { text: "No one really - we're all pretty traditional", score: 1 }, { text: "One or two people dabble sometimes", score: 2 }, { text: "A few early adopters in different teams", score: 3 }, { text: "Most teams have someone keen to innovate", score: 4 }, { text: "Innovation is part of our culture across the board", score: 5 } ] }, { id: "tc_2", question: "When someone discovers a better way to do something, what typically happens?", dimension: "transformation", weight: 1.3, valuationCategory: "operational", options: [ { text: "They keep it to themselves or their immediate team", score: 1 }, { text: "They might mention it but it rarely spreads", score: 2 }, { text: "They share it but adoption is inconsistent", score: 3 }, { text: "We have ways to share and most people try it", score: 4 }, { text: "New methods spread quickly and become standard", score: 5 } ] }, { id: "tc_3", question: "If you were to roll out AI tools tomorrow, who would naturally lead the charge?", dimension: "transformation", weight: 1.5, valuationCategory: "operational", options: [ { text: "Honestly, no obvious candidates", score: 1 }, { text: "Maybe one person but they're already swamped", score: 2 }, { text: "A couple of people could do it with support", score: 3 }, { text: "Several strong candidates across teams", score: 4 }, { text: "Multiple champions already pushing for this", score: 5 } ] }, { id: "tc_4", question: "How do different departments/teams share knowledge and collaborate?", dimension: "transformation", weight: 1.0, valuationCategory: "operational", options: [ { text: "They don't - everyone works in silos", score: 1 }, { text: "Occasional meetings but limited sharing", score: 2 }, { text: "Regular meetings and some collaboration", score: 3 }, { text: "Good collaboration on most projects", score: 4 }, { text: "Seamless collaboration is our standard", score: 5 } ] }, { id: "tc_5", question: "What's the typical reaction when someone suggests trying a new approach?", dimension: "transformation", weight: 1.1, valuationCategory: "strategic", options: [ { text: '"We\'ve always done it this way"', score: 1 }, { text: "Skepticism and reluctance to change", score: 2 }, { text: "Cautious interest if there's clear benefit", score: 3 }, { text: "Generally open to testing new ideas", score: 4 }, { text: "Excitement and eagerness to experiment", score: 5 } ] } ],
                resourcesConstraints: [ { id: "rc_1", question: "How much could you realistically invest in AI tools and training monthly?", dimension: "resources", weight: 1.2, valuationCategory: "financial", options: [ { text: "Nothing - we're barely breaking even", score: 1 }, { text: "£100-500 if it really proved ROI quickly", score: 2 }, { text: "£500-1500 for the right solutions", score: 3 }, { text: "£1500-3000 for transformation", score: 4 }, { text: "£3000+ - we're ready to invest seriously", score: 5 } ] }, { id: "rc_2", question: "How many hours per week could your team dedicate to learning and implementing AI?", dimension: "resources", weight: 1.0, valuationCategory: "operational", options: [ { text: "Zero - we're completely maxed out", score: 1 }, { text: "1-2 hours if we really squeeze", score: 2 }, { text: "3-5 hours by adjusting priorities", score: 3 }, { text: "5-10 hours - we can make time", score: 4 }, { text: "10+ hours - this is a priority", score: 5 } ] }, { id: "rc_3", question: "What's your biggest constraint to adopting new technology?", dimension: "resources", weight: 1.3, valuationCategory: "operational", options: [ { text: "Cash flow - can't afford anything extra", score: 1 }, { text: "Time - too busy with client work", score: 2 }, { text: "Skills - team struggles with new tech", score: 3 }, { text: "Minor constraints we can work around", score: 4 }, { text: "No major constraints - ready to go", score: 5 } ] }, { id: "rc_4", question: "How predictable is your revenue over the next 3 months?", dimension: "resources", weight: 1.5, valuationCategory: "financial", valuationImpact: "critical", options: [ { text: "Totally unpredictable - feast or famine", score: 1 }, { text: "Some visibility but lots of uncertainty", score: 2 }, { text: "Reasonably predictable with some gaps", score: 3 }, { text: "Pretty solid - 70%+ confirmed", score: 4 }, { text: "Very predictable - mostly recurring revenue", score: 5 } ] } ],
                leadershipCulture: [ { id: "lc_1", question: "How does leadership view AI and automation in creative/marketing work?", dimension: "leadership", weight: 1.5, valuationCategory: "strategic", options: [ { text: "Threat to our craft and quality", score: 1 }, { text: "Necessary evil we'll eventually face", score: 2 }, { text: "Interesting but not sure how it fits", score: 3 }, { text: "Opportunity to enhance our work", score: 4 }, { text: "Critical to our future success", score: 5 } ] }, { id: "lc_2", question: "How do important decisions about new services or approaches get made?", dimension: "leadership", weight: 1.0, valuationCategory: "operational", options: [ { text: "Founder/owner decides everything", score: 1 }, { text: "Senior leadership with little input", score: 2 }, { text: "Leadership team discusses and decides", score: 3 }, { text: "Input from teams then leadership decides", score: 4 }, { text: "Collaborative with strong team involvement", score: 5 } ] }, { id: "lc_3", question: "When it comes to trying new approaches with client work, your agency is:", dimension: "leadership", weight: 1.2, valuationCategory: "strategic", options: [ { text: "Very conservative - stick to what works", score: 1 }, { text: "Cautious - need client approval for everything", score: 2 }, { text: "Balanced - innovate within boundaries", score: 3 }, { text: "Progressive - often suggest new approaches", score: 4 }, { text: "Innovative - clients expect cutting-edge", score: 5 } ] }, { id: "lc_4", question: "What metrics matter most to your leadership?", dimension: "leadership", weight: 1.1, valuationCategory: "financial", options: [ { text: "Just staying afloat and paying bills", score: 1 }, { text: "Revenue and basic profitability", score: 2 }, { text: "Profit margins and utilization rates", score: 3 }, { text: "Growth, margins, and client satisfaction", score: 4 }, { text: "Innovation metrics alongside financial KPIs", score: 5 } ] }, { id: "lc_5", question: "If budget allowed, would leadership prefer to hire specialists or train existing team?", dimension: "leadership", weight: 1.0, valuationCategory: "strategic", options: [ { text: "Always hire - don't trust team to learn", score: 1 }, { text: "Usually hire - training takes too long", score: 2 }, { text: "Depends on the situation", score: 3 }, { text: "Prefer training - team knows our clients", score: 4 }, { text: "Always train - investment in our people", score: 5 } ] } ],
                changeReadiness: [ { id: "cr_1", question: "Think about your last major change (new service, system, process) - how did it go?", dimension: "change", weight: 1.3, valuationCategory: "operational", options: [ { text: "Disaster - we still talk about how bad it was", score: 1 }, { text: "Rocky - lots of resistance and issues", score: 2 }, { text: "Eventually worked but took longer than expected", score: 3 }, { text: "Pretty smooth with minor hiccups", score: 4 }, { text: "Great success - now core to our business", score: 5 } ] }, { id: "cr_2", question: "How many of your team are currently experimenting with AI tools (officially or unofficially)?", dimension: "change", weight: 1.5, valuationCategory: "ai", options: [ { text: "None that I know of", score: 1 }, { text: "One or two people quietly testing", score: 2 }, { text: "Several people trying different tools", score: 3 }, { text: "Many experimenting, some sharing results", score: 4 }, { text: "Widespread experimentation and sharing", score: 5 } ] }, { id: "cr_3", question: "What happens when a new initiative doesn't deliver expected results?", dimension: "change", weight: 1.1, valuationCategory: "strategic", options: [ { text: 'Blame and "I told you so" attitudes', score: 1 }, { text: "Disappointment and reluctance to try again", score: 2 }, { text: "Review what went wrong and move on", score: 3 }, { text: "Learn from it and adjust approach", score: 4 }, { text: "Celebrate the learning and iterate quickly", score: 5 } ] }, { id: "cr_4", question: "How well documented are your current processes and ways of working?", dimension: "change", weight: 1.2, valuationCategory: "operational", valuationImpact: "high", options: [ { text: "Nothing written - all in people's heads", score: 1 }, { text: "Some notes but mostly tribal knowledge", score: 2 }, { text: "Key processes documented but outdated", score: 3 }, { text: "Good documentation, mostly current", score: 4 }, { text: "Excellent living documentation", score: 5 } ] }, { id: "cr_5", question: "How did your agency adapt during COVID/remote working?", dimension: "change", weight: 1.0, valuationCategory: "operational", options: [ { text: "Barely survived - still recovering", score: 1 }, { text: "Struggled but made it through", score: 2 }, { text: "Adapted reasonably well after initial shock", score: 3 }, { text: "Quickly pivoted and found new opportunities", score: 4 }, { text: "Thrived and came out stronger", score: 5 } ] }, { id: "cr_6", question: "What percentage of revenue comes from your largest client?", dimension: "change", weight: 1.5, valuationCategory: "financial", valuationImpact: "critical", options: [ { text: "Over 50% - they're everything to us", score: 1 }, { text: "30-50% - would hurt badly to lose them", score: 2 }, { text: "20-30% - significant but manageable", score: 3 }, { text: "10-20% - important but not critical", score: 4 }, { text: "Under 10% - well diversified", score: 5 } ] } ]
            },
            serviceQuestions: {
                content_creation: { serviceName: "Content Creation", aiVulnerability: 85, questions: [ { id: "content_1", question: "What's the biggest pain point in your content creation process?", dimension: "service_pain", weight: 1.3, options: [ { text: "Everything takes forever to write", score: 1 }, { text: "Research and ideation eat up hours", score: 2 }, { text: "Maintaining consistent quality at scale", score: 3 }, { text: "Fine-tuning voice and tone", score: 4 }, { text: "Distribution and performance tracking", score: 5 } ] }, { id: "content_2", question: "How long does it typically take to create a 1000-word blog post?", dimension: "service_efficiency", weight: 1.2, options: [ { text: "4-6 hours or more", score: 1 }, { text: "3-4 hours usually", score: 2 }, { text: "2-3 hours on average", score: 3 }, { text: "1-2 hours with our process", score: 4 }, { text: "Under an hour with tools/templates", score: 5 } ] }, { id: "content_3", question: "How do you balance content quality vs quantity demands from clients?", dimension: "service_quality", weight: 1.0, options: [ { text: "We can't - always sacrificing one for the other", score: 1 }, { text: "Struggle constantly with this trade-off", score: 2 }, { text: "Manage it but it's challenging", score: 3 }, { text: "Found a good balance that works", score: 4 }, { text: "Deliver both through efficient systems", score: 5 } ] }, { id: "content_4", question: "What tools does your content team currently use?", dimension: "service_tools", weight: 1.0, options: [ { text: "Just Google Docs and basic research", score: 1 }, { text: "Some SEO tools for keyword research", score: 2 }, { text: "Content planning tools and templates", score: 3 }, { text: "Advanced SEO and content optimization tools", score: 4 }, { text: "Already using some AI writing assistants", score: 5 } ] }, { id: "content_5", question: "If AI could help with one aspect of content, what would be most valuable?", dimension: "service_ai_opportunity", weight: 1.5, options: [ { text: "Just getting first drafts done faster", score: 3 }, { text: "Research and fact-checking", score: 3 }, { text: "SEO optimization and keywords", score: 4 }, { text: "Scaling personalized content", score: 5 }, { text: "Predictive content performance", score: 5 } ] } ] },
                creative_design: { serviceName: "Creative & Design", aiVulnerability: 65, questions: [ { id: "creative_1", question: "What takes the most time in your creative process?", dimension: "service_pain", weight: 1.3, options: [ { text: "Coming up with initial concepts", score: 2 }, { text: "Endless client revisions", score: 1 }, { text: "Creating multiple variations", score: 2 }, { text: "Production and final files", score: 3 }, { text: "Strategy and creative briefs", score: 5 } ] }, { id: "creative_2", question: "How many concept options do you typically present to clients?", dimension: "service_efficiency", weight: 1.0, options: [ { text: "1-2 and hope they like them", score: 1 }, { text: "3 options is our standard", score: 2 }, { text: "3-5 depending on the project", score: 3 }, { text: "5-10 to show range", score: 4 }, { text: "As many as needed - we iterate fast", score: 5 } ] }, { id: "creative_3", question: "How do you handle requests for 'quick variations' or resize?", dimension: "service_quality", weight: 1.2, options: [ { text: "They're never quick - always painful", score: 1 }, { text: "Disrupt our workflow but we manage", score: 2 }, { text: "Built into our process but time-consuming", score: 3 }, { text: "Pretty efficient with templates/systems", score: 4 }, { text: "Automated or near-instant", score: 5 } ] }, { id: "creative_4", question: "What's your current design toolkit?", dimension: "service_tools", weight: 1.0, options: [ { text: "Basic Adobe Creative Suite", score: 1 }, { text: "Full Adobe plus some plugins", score: 2 }, { text: "Adobe, Figma, and collaboration tools", score: 3 }, { text: "Modern stack with automation features", score: 4 }, { text: "Already integrating AI design tools", score: 5 } ] }, { id: "creative_5", question: "Where could AI add most value to your creative process?", dimension: "service_ai_opportunity", weight: 1.5, options: [ { text: "Removing tedious production work", score: 3 }, { text: "Generating initial concepts faster", score: 4 }, { text: "Creating variations automatically", score: 4 }, { text: "Predicting client preferences", score: 5 }, { text: "Enhancing creative strategy", score: 5 } ] } ] },
                digital_marketing: { serviceName: "Digital Marketing", aiVulnerability: 75, questions: [ { id: "digital_1", question: "What's your biggest challenge in managing digital campaigns?", dimension: "service_pain", weight: 1.3, options: [ { text: "Too many platforms to manage effectively", score: 1 }, { text: "Can't optimize fast enough", score: 2 }, { text: "Proving ROI to clients", score: 3 }, { text: "Scaling successful campaigns", score: 4 }, { text: "Staying ahead of platform changes", score: 4 } ] }, { id: "digital_2", question: "How much time does campaign optimization take weekly per client?", dimension: "service_efficiency", weight: 1.2, options: [ { text: "10+ hours - it's overwhelming", score: 1 }, { text: "5-10 hours of manual work", score: 2 }, { text: "3-5 hours with our process", score: 3 }, { text: "1-3 hours with good tools", score: 4 }, { text: "Mostly automated monitoring", score: 5 } ] }, { id: "digital_3", question: "How do you currently handle campaign reporting?", dimension: "service_quality", weight: 1.0, options: [ { text: "Manual spreadsheets - takes forever", score: 1 }, { text: "Platform exports with manual formatting", score: 2 }, { text: "Reporting templates we update", score: 3 }, { text: "Automated dashboards with some manual work", score: 4 }, { text: "Fully automated with insights", score: 5 } ] }, { id: "digital_4", question: "What tools are you using for campaign management?", dimension: "service_tools", weight: 1.0, options: [ { text: "Just the native platform interfaces", score: 1 }, { text: "Native platforms plus spreadsheets", score: 2 }, { text: "Some third-party management tools", score: 3 }, { text: "Comprehensive marketing platform", score: 4 }, { text: "Advanced stack with AI features", score: 5 } ] }, { id: "digital_5", question: "Where would AI help most in your digital marketing?", dimension: "service_ai_opportunity", weight: 1.5, options: [ { text: "Writing ad copy variations", score: 3 }, { text: "Audience targeting and segmentation", score: 4 }, { text: "Bid optimization and budget allocation", score: 4 }, { text: "Predictive performance modeling", score: 5 }, { text: "Full campaign automation", score: 5 } ] } ] },
                seo_sem: { serviceName: "SEO/SEM", aiVulnerability: 80, questions: [ { id: "seo_1", question: "What's the most time-consuming part of SEO work?", dimension: "service_pain", weight: 1.3, options: [ { text: "Keyword research takes days", score: 1 }, { text: "Technical audits are brutal", score: 2 }, { text: "Content optimization never ends", score: 2 }, { text: "Reporting and proving value", score: 3 }, { text: "Keeping up with algorithm changes", score: 4 } ] }, { id: "seo_2", question: "How long does a comprehensive SEO audit typically take?", dimension: "service_efficiency", weight: 1.2, options: [ { text: "2-3 days of solid work", score: 1 }, { text: "1-2 days with our process", score: 2 }, { text: "1 day with good tools", score: 3 }, { text: "Half day with automation", score: 4 }, { text: "2-3 hours with our systems", score: 5 } ] }, { id: "seo_3", question: "How do you demonstrate SEO value to clients?", dimension: "service_quality", weight: 1.0, options: [ { text: "Struggle to show clear ROI", score: 1 }, { text: "Basic ranking reports", score: 2 }, { text: "Traffic and ranking improvements", score: 3 }, { text: "Tied to conversions and revenue", score: 4 }, { text: "Predictive value modeling", score: 5 } ] }, { id: "seo_4", question: "What's your current SEO toolkit?", dimension: "service_tools", weight: 1.0, options: [ { text: "Free tools and Google Search Console", score: 1 }, { text: "One main paid tool (SEMrush/Ahrefs)", score: 2 }, { text: "Multiple specialized tools", score: 3 }, { text: "Enterprise SEO platform", score: 4 }, { text: "AI-enhanced SEO suite", score: 5 } ] }, { id: "seo_5", question: "Where would AI transform your SEO service?", dimension: "service_ai_opportunity", weight: 1.5, options: [ { text: "Faster keyword research", score: 3 }, { text: "Automated content optimization", score: 4 }, { text: "Predictive ranking algorithms", score: 4 }, { text: "Competitive intelligence at scale", score: 5 }, { text: "Self-optimizing SEO strategies", score: 5 } ] } ] },
                pr_comms: { serviceName: "PR & Communications", aiVulnerability: 60, questions: [ { id: "pr_1", question: "What's your biggest challenge in PR work?", dimension: "service_pain", weight: 1.3, options: [ { text: "Finding relevant media contacts", score: 2 }, { text: "Writing endless press releases", score: 1 }, { text: "Tracking coverage and sentiment", score: 3 }, { text: "Proving PR impact to clients", score: 3 }, { text: "Strategic narrative development", score: 5 } ] }, { id: "pr_2", question: "How long to draft and distribute a press release?", dimension: "service_efficiency", weight: 1.2, options: [ { text: "Full day or more", score: 1 }, { text: "4-6 hours typically", score: 2 }, { text: "2-4 hours with templates", score: 3 }, { text: "1-2 hours streamlined", score: 4 }, { text: "Under an hour with our system", score: 5 } ] }, { id: "pr_3", question: "How do you track and report PR coverage?", dimension: "service_quality", weight: 1.0, options: [ { text: "Manual Google searches and spreadsheets", score: 1 }, { text: "Basic monitoring tools", score: 2 }, { text: "Professional monitoring platform", score: 3 }, { text: "Automated tracking with analytics", score: 4 }, { text: "AI-powered sentiment and impact analysis", score: 5 } ] }, { id: "pr_4", question: "What tools support your PR efforts?", dimension: "service_tools", weight: 1.0, options: [ { text: "Email and spreadsheets mostly", score: 1 }, { text: "Basic media database", score: 2 }, { text: "PR platform (Cision/Meltwater)", score: 3 }, { text: "Integrated PR and analytics suite", score: 4 }, { text: "AI-enhanced PR platform", score: 5 } ] }, { id: "pr_5", question: "Where could AI add most value to PR?", dimension: "service_ai_opportunity", weight: 1.5, options: [ { text: "Writing press releases faster", score: 3 }, { text: "Finding the right journalists", score: 4 }, { text: "Predicting story pickup", score: 4 }, { text: "Real-time crisis monitoring", score: 5 }, { text: "Strategic narrative optimization", score: 5 } ] } ] },
                strategy_consulting: { serviceName: "Strategy & Consulting", aiVulnerability: 35, questions: [ { id: "strategy_1", question: "What's most challenging about strategy work?", dimension: "service_pain", weight: 1.3, options: [ { text: "Getting enough data for insights", score: 2 }, { text: "Analysis takes too long", score: 2 }, { text: "Translating strategy to tactics", score: 3 }, { text: "Keeping strategies current", score: 4 }, { text: "Differentiating our approach", score: 5 } ] }, { id: "strategy_2", question: "How long does a typical strategy project take?", dimension: "service_efficiency", weight: 1.2, options: [ { text: "Months - very thorough process", score: 1 }, { text: "4-6 weeks standard", score: 2 }, { text: "2-4 weeks with our framework", score: 3 }, { text: "1-2 weeks intensive sprint", score: 4 }, { text: "Days with our rapid process", score: 5 } ] }, { id: "strategy_3", question: "How do you gather market insights?", dimension: "service_quality", weight: 1.0, options: [ { text: "Manual research and gut feel", score: 1 }, { text: "Basic desk research", score: 2 }, { text: "Mix of research and data tools", score: 3 }, { text: "Comprehensive data platforms", score: 4 }, { text: "AI-powered insight generation", score: 5 } ] }, { id: "strategy_4", question: "What tools support your strategy work?", dimension: "service_tools", weight: 1.0, options: [ { text: "PowerPoint and Excel", score: 1 }, { text: "Plus some research tools", score: 2 }, { text: "Strategy frameworks and templates", score: 3 }, { text: "Advanced analytics platforms", score: 4 }, { text: "AI-powered strategy tools", score: 5 } ] }, { id: "strategy_5", question: "Where would AI help most in strategy?", dimension: "service_ai_opportunity", weight: 1.5, options: [ { text: "Faster market research", score: 3 }, { text: "Competitive analysis at scale", score: 4 }, { text: "Trend prediction and forecasting", score: 4 }, { text: "Scenario modeling and simulation", score: 5 }, { text: "Dynamic strategy optimization", score: 5 } ] } ] }
            },
            scoring: { dimensions: { transformation: { weight: 0.25, displayName: "AI Readiness" }, resources: { weight: 0.20, displayName: "Resource Availability" }, leadership: { weight: 0.20, displayName: "Leadership Alignment" }, change: { weight: 0.35, displayName: "Change Capability" } }, valuationDimensions: { financial: { weight: 0.35, displayName: "Financial Health" }, operational: { weight: 0.30, displayName: "Operational Excellence" }, strategic: { weight: 0.20, displayName: "Strategic Position" }, ai: { weight: 0.15, displayName: "AI Capability" } }, serviceVulnerabilityWeights: { content_creation: 0.85, seo_sem: 0.80, digital_marketing: 0.75, creative_design: 0.65, pr_comms: 0.60, video_production: 0.55, strategy_consulting: 0.35 } }
        };

        // InHouseMarketingAssessment (from memory)
        const InHouseMarketingAssessment = {
            id: "inhouse-marketing-v3", 
            title: "AI Marketing Readiness Assessment", 
            description: "Discover how prepared your marketing team is for AI transformation",
            marketBenchmarks: { 
                aiAdoption: { 
                    2023: { small: 23, medium: 55, large: 78 }, 
                    2024: { small: 40, medium: 71, large: 86 } 
                }, 
                timesSaved: { 
                    content: { avg: 70, top: 85 }, 
                    email: { avg: 50, top: 75 }, 
                    social: { avg: 60, top: 80 }, 
                    analytics: { avg: 40, top: 65 } 
                }, 
                toolAdoption: { 
                    contentAI: 56, 
                    emailAI: 35, 
                    analyticsAI: 42, 
                    creativeAI: 52 
                },
                adoption: { 2024: { marketing: 87 } },
                productivity: { 
                    contentCreation: { avg: 50 }, 
                    reporting: { avg: 70 } 
                },
                transformation: { 
                    small: { timeline: "3-6 months", budget: "£200-500/month" }, 
                    medium: { timeline: "6-9 months", budget: "£500-2000/month" } 
                },
                roi: { multiplier: "5-15x within 6 months" }
            },
            qualifying: [
                { id: "company_industry", question: "What industry is your company in?", type: "single-select", required: true, options: [ { value: "b2b_saas", label: "B2B SaaS / Technology" }, { value: "ecommerce_retail", label: "E-commerce / Retail" }, { value: "professional_services", label: "Professional Services" }, { value: "manufacturing_industrial", label: "Manufacturing / Industrial" }, { value: "healthcare_pharma", label: "Healthcare / Pharma" }, { value: "other_inhouse", label: "Other Industry" } ] },
                { id: "team_size", question: "How many people are in your marketing team?", type: "single-select", required: true, options: [ { value: "solo", label: "Just Me (Solo Marketer)", score: 1 }, { value: "2-5", label: "2-5 people (Small Team)", score: 2 }, { value: "6-15", label: "6-15 people (Medium Team)", score: 3 }, { value: "16+", label: "16+ people (Large Team)", score: 4 } ] },
                { id: "company_revenue_inhouse", question: "What's your company's approximate annual revenue?", type: "single-select", required: true, options: [ { value: "under-1m", label: "Under £1M", score: 1 }, { value: "1m-5m", label: "£1M - £5M", score: 2 }, { value: "5m-20m", label: "£5M - £20M", score: 3 }, { value: "20m-50m", label: "£20M - £50M", score: 4 }, { value: "50m+", label: "Over £50M", score: 5 } ] }
            ],
            coreQuestions: [
                { id: "champion_identification", category: "champions", question: "Is there someone on your team who gets excited about trying new marketing tools?", weight: 4, options: [ { value: 0, label: "No one really - we stick to what we know" }, { value: 2, label: "Maybe one person, but they keep it to themselves" }, { value: 3, label: "Yes, and they occasionally share discoveries" }, { value: 4, label: "Yes, they're always showing us new things" }, { value: 5, label: "Multiple people compete to find cool new tools" } ], insight: "Having an AI champion is the #1 predictor of successful transformation" },
                { id: "knowledge_sharing", category: "champions", question: "When someone learns something new, what typically happens?", weight: 3, options: [ { value: 0, label: "They use it quietly on their own" }, { value: 2, label: "They might mention it in passing" }, { value: 3, label: "They share with their immediate teammates" }, { value: 4, label: "We have informal knowledge sharing sessions" }, { value: 5, label: "We document and train everyone systematically" } ] },
                { id: "experimentation_culture", category: "champions", question: "What happens when someone tries a new approach and it doesn't work perfectly?", weight: 3.5, options: [ { value: 0, label: "They get criticized - we can't afford mistakes" }, { value: 1, label: "Nothing said, but you can feel the disappointment" }, { value: 3, label: "It's okay as long as it doesn't happen often" }, { value: 4, label: "We discuss what we learned from it" }, { value: 5, label: "It's celebrated as learning - fail fast, learn faster" } ] },
                { id: "tool_discovery", category: "champions", question: "How does your team typically find out about new marketing tools?", weight: 2, options: [ { value: 1, label: "Usually when a vendor contacts us" }, { value: 2, label: "When competitors start using something" }, { value: 3, label: "Through industry newsletters or events" }, { value: 4, label: "Team members actively research and share" }, { value: 5, label: "We have a process for continuous tool discovery" } ] },
                { id: "change_adoption", category: "champions", question: "Think about the last time you introduced a new tool or process. How did it go?", weight: 3, options: [ { value: 0, label: "Poorly - people resisted and we gave up" }, { value: 1, label: "Very slowly with lots of grumbling" }, { value: 2, label: "Eventually adopted but took months" }, { value: 3, label: "Reasonable adoption with some training" }, { value: 4, label: "Smooth - people were eager to learn" }, { value: 5, label: "Fast adoption - we're good at change" } ] },
                { id: "time_availability", category: "resources", question: "If we said 'spend 2 hours this week learning AI tools', what would happen?", weight: 3.5, options: [ { value: 0, label: "Impossible - we're drowning in work" }, { value: 1, label: "Maybe one person could find time" }, { value: 2, label: "We'd have to drop something else" }, { value: 3, label: "We could make it work with planning" }, { value: 4, label: "No problem - we protect time for learning" }, { value: 5, label: "We already dedicate time to skill development" } ] },
                { id: "budget_flexibility", category: "resources", question: "If an AI tool could save 10 hours/week but cost £200/month, what would happen?", weight: 3, options: [ { value: 0, label: "No chance - zero budget flexibility" }, { value: 1, label: "Would need months of approval process" }, { value: 2, label: "Could maybe squeeze £50/month" }, { value: 3, label: "Would need to prove ROI first in free trial" }, { value: 4, label: "Could do it if we showed clear time savings" }, { value: 5, label: "Easy decision - we invest in efficiency" } ], benchmark: "62% of similar teams now allocate £200-500/month for AI tools" },
                { id: "current_pain", category: "resources", question: "What's your team's biggest frustration right now?", weight: 2.5, options: [ { value: 3, label: "Too much work, not enough people" }, { value: 3, label: "Repetitive tasks eating creative time" }, { value: 4, label: "Can't produce content fast enough" }, { value: 4, label: "Drowning in data but no insights" }, { value: 2, label: "Everything takes too many approvals" }, { value: 3, label: "Quality inconsistency across outputs" } ] },
                { id: "tech_complexity", category: "resources", question: "How many different marketing tools does your team use regularly?", weight: 2, options: [ { value: 4, label: "Just basics - email, docs, maybe one other" }, { value: 3, label: "5-10 tools - manageable set" }, { value: 2, label: "10-20 tools - bit overwhelming" }, { value: 1, label: "20+ tools - total chaos" }, { value: 0, label: "So many we've lost count" } ], insight: "Teams with 5-15 tools adopt AI fastest" },
                { id: "capacity_reality", category: "resources", question: "Honestly, how much of your week is reactive vs. planned work?", weight: 2.5, options: [ { value: 0, label: "90%+ reactive - always fighting fires" }, { value: 1, label: "70% reactive - some planning" }, { value: 2, label: "50/50 - balanced but stretched" }, { value: 3, label: "30% reactive - mostly planned" }, { value: 4, label: "10% reactive - well organised" }, { value: 5, label: "Proactive - we control our time" } ] },
                { id: "leadership_ai_attitude", category: "leadership", question: "What's your leadership's real attitude toward AI?", weight: 4, options: [ { value: 0, label: 'Skeptical - "just another tech fad"' }, { value: 1, label: "Nervous - worried about risks" }, { value: 2, label: "Curious but cautious" }, { value: 3, label: "Supportive if we show ROI" }, { value: 4, label: "Actively pushing us to use AI" }, { value: 5, label: "Leading by example with AI" } ], benchmark: "73% of leaders now actively encourage AI adoption" },
                { id: "decision_speed", category: "leadership", question: "How long would it take to get approval for a new AI tool?", weight: 3, options: [ { value: 0, label: "Months of committees and papers" }, { value: 1, label: "6-8 weeks typical" }, { value: 2, label: "2-4 weeks with good case" }, { value: 3, label: "1-2 weeks for small investments" }, { value: 4, label: "Days if it makes sense" }, { value: 5, label: "Team empowered to decide" } ] },
                { id: "success_metrics", category: "leadership", question: "What metrics actually matter to your leadership?", weight: 3, options: [ { value: 2, label: "Just don't overspend budget" }, { value: 3, label: "Volume - more content, more campaigns" }, { value: 4, label: "Quality - better engagement rates" }, { value: 4, label: "Efficiency - doing more with less" }, { value: 5, label: "Revenue impact and ROI" }, { value: 5, label: "Innovation and competitive edge" } ] },
                { id: "transformation_ownership", category: "leadership", question: "If you implemented AI across marketing, who would own it?", weight: 3.5, options: [ { value: 0, label: "No one - it would be chaos" }, { value: 1, label: "Probably dumped on IT" }, { value: 2, label: "Whoever suggested it (reluctantly)" }, { value: 3, label: "Marketing ops or similar role" }, { value: 4, label: "Clear owner who wants it" }, { value: 5, label: "Shared ownership with executive sponsor" } ] },
                { id: "risk_tolerance", category: "leadership", question: "What's the real attitude toward trying new things that might fail?", weight: 3, options: [ { value: 0, label: "Failure is not an option here" }, { value: 1, label: "Okay if no one notices" }, { value: 2, label: "Small failures tolerated quietly" }, { value: 3, label: "Calculated risks are fine" }, { value: 4, label: "Fail fast, learn faster mentality" }, { value: 5, label: "Innovation requires experimentation" } ] },
                { id: "current_ai_usage", category: "readiness", question: "Be honest - is anyone already using AI tools like ChatGPT for work?", weight: 3, options: [ { value: 1, label: "No, and we've told people not to" }, { value: 2, label: "Don't think so, but haven't asked" }, { value: 3, label: "Probably - people do their own thing" }, { value: 4, label: "Yes, some are experimenting" }, { value: 5, label: "Yes, with guidelines in place" }, { value: 5, label: "Yes, it's encouraged and supported" } ], benchmark: "87% of marketing teams have at least one person using AI tools" },
                { id: "process_documentation", category: "readiness", question: "How well documented are your current marketing processes?", weight: 2.5, options: [ { value: 0, label: "What documentation?" }, { value: 1, label: "It's all in people's heads" }, { value: 2, label: "Some key things written down" }, { value: 3, label: "Most processes documented somewhere" }, { value: 4, label: "Well documented and maintained" }, { value: 5, label: "Living playbooks everyone uses" } ], insight: "Well-documented teams adopt AI 3x faster" },
                { id: "data_organization", category: "readiness", question: "How organized is your marketing data and content?", weight: 2.5, options: [ { value: 0, label: "Complete chaos across drives and tools" }, { value: 1, label: "I know where MY stuff is" }, { value: 2, label: "Sort of organized by person" }, { value: 3, label: "Decent folder structure exists" }, { value: 4, label: "Well organized and searchable" }, { value: 5, label: "Tagged, indexed, and accessible" } ] },
                { id: "quality_control", category: "readiness", question: "How do you ensure quality and brand consistency now?", weight: 3, options: [ { value: 1, label: "Hope for the best" }, { value: 2, label: "Manager reviews everything" }, { value: 3, label: "Peer reviews when time allows" }, { value: 4, label: "Clear process with checklists" }, { value: 5, label: "Templates, guides, and reviews" }, { value: 5, label: "Systematic QA process" } ] },
                { id: "measurement_culture", category: "readiness", question: "How do you measure if something worked?", weight: 2, options: [ { value: 0, label: "We don't really measure" }, { value: 1, label: "Basic metrics when asked" }, { value: 2, label: "Regular reports on activity" }, { value: 3, label: "Track engagement and conversions" }, { value: 4, label: "Detailed analytics and insights" }, { value: 5, label: "Continuous optimization culture" } ] }
            ],
            activityQuestions: {
                content_marketing: [ { id: "content_volume_struggle", question: "How do you feel about your content output volume?", weight: 2.5, options: [ { value: 0, label: "We're way behind - can't keep up with demand" }, { value: 2, label: "Always playing catch-up" }, { value: 3, label: "Managing but it's stressful" }, { value: 4, label: "Good volume but quality varies" }, { value: 5, label: "Happy with volume and quality" } ], benchmark: "Teams using AI produce 3.5x more content" }, { id: "content_time_breakdown", question: "Where does most time go in content creation?", weight: 2, options: [ { value: 1, label: "Research and figuring out what to write" }, { value: 2, label: "Writing the first draft" }, { value: 2, label: "Endless editing rounds" }, { value: 3, label: "Getting approvals" }, { value: 4, label: "Formatting and publishing" } ] }, { id: "content_repurposing", question: "How much do you repurpose content across channels?", weight: 2, options: [ { value: 0, label: "Never - everything created fresh" }, { value: 1, label: "Occasionally when we remember" }, { value: 2, label: "Try to but it's manual work" }, { value: 3, label: "Regular repurposing process" }, { value: 4, label: "Systematic multi-channel approach" } ] }, { id: "content_ideation", question: "How do you come up with content ideas?", weight: 1.5, options: [ { value: 1, label: "Struggle every month for ideas" }, { value: 2, label: "Reactive to requests and trends" }, { value: 3, label: "Basic content calendar planning" }, { value: 4, label: "Data-driven topic selection" }, { value: 5, label: "Strategic content pipeline" } ] }, { id: "content_ai_openness", question: "How do you feel about AI writing assistance?", weight: 3, options: [ { value: 0, label: "Worried it will replace writers" }, { value: 1, label: "Skeptical about quality" }, { value: 3, label: "Curious but unsure how to start" }, { value: 4, label: "Excited about the possibilities" }, { value: 5, label: "Already experimenting with it" } ] } ],
                social_media: [ { id: "social_overwhelm", question: "How manageable is your social media workload?", weight: 2.5, options: [ { value: 0, label: "Drowning - can't keep up with all platforms" }, { value: 1, label: "Constantly stressed about posting" }, { value: 2, label: "Managing but no time for engagement" }, { value: 3, label: "Okay but wish we could do more" }, { value: 4, label: "Comfortable with current approach" } ] }, { id: "social_time_spent", question: "How much time does social media take weekly?", weight: 2, options: [ { value: 1, label: "20+ hours - it's a full-time job" }, { value: 2, label: "15-20 hours - major time sink" }, { value: 3, label: "10-15 hours - significant chunk" }, { value: 4, label: "5-10 hours - manageable" }, { value: 5, label: "Under 5 hours - well optimized" } ], benchmark: "AI users spend 60% less time on social media management" }, { id: "social_content_creation", question: "How do you create social media visuals?", weight: 2, options: [ { value: 0, label: "Struggle with every post" }, { value: 1, label: "Basic templates when we can" }, { value: 2, label: "Designer creates when available" }, { value: 3, label: "Mix of templates and custom" }, { value: 4, label: "Efficient design process" } ] }, { id: "social_scheduling", question: "How do you handle posting schedules?", weight: 1.5, options: [ { value: 0, label: "Manual posting when we remember" }, { value: 1, label: "Basic scheduling tool" }, { value: 2, label: "Schedule week by week" }, { value: 3, label: "Month planned in advance" }, { value: 4, label: "Automated with optimization" } ] }, { id: "social_performance", question: "How well can you track what works on social?", weight: 2, options: [ { value: 0, label: "No idea what resonates" }, { value: 1, label: "Basic likes and comments" }, { value: 2, label: "Platform analytics only" }, { value: 3, label: "Track engagement patterns" }, { value: 4, label: "Detailed performance insights" } ] } ],
                email_marketing: [ { id: "email_personalization", question: "How personalized are your email campaigns?", weight: 2.5, options: [ { value: 0, label: "Same message to everyone" }, { value: 1, label: "Basic name personalization" }, { value: 2, label: "Some segmentation by list" }, { value: 3, label: "Behavior-based segments" }, { value: 4, label: "Dynamic content per recipient" } ], benchmark: "AI-powered emails see 41% higher click rates" }, { id: "email_writing_time", question: "How long does it take to write a marketing email?", weight: 2, options: [ { value: 0, label: "Hours - agonize over every word" }, { value: 1, label: "2-3 hours typically" }, { value: 2, label: "1-2 hours with templates" }, { value: 3, label: "30-60 minutes" }, { value: 4, label: "Under 30 minutes" } ] }, { id: "email_subject_lines", question: "How do you create subject lines?", weight: 2, options: [ { value: 0, label: "Last-minute guess" }, { value: 1, label: "One option and hope" }, { value: 2, label: "Try 2-3 variants" }, { value: 3, label: "A/B test regularly" }, { value: 4, label: "Data-driven optimization" } ] }, { id: "email_automation", question: "How automated are your email workflows?", weight: 2, options: [ { value: 0, label: "Everything manual" }, { value: 1, label: "Basic welcome email" }, { value: 2, label: "Few simple automations" }, { value: 3, label: "Key journeys automated" }, { value: 4, label: "Sophisticated automation" } ] }, { id: "email_performance_analysis", question: "How do you improve email performance?", weight: 1.5, options: [ { value: 0, label: "We don't really analyze" }, { value: 1, label: "Check opens sometimes" }, { value: 2, label: "Review basic metrics" }, { value: 3, label: "Test and iterate" }, { value: 4, label: "Continuous optimization" } ] } ],
                seo_sem: [ { id: "seo_keyword_research", question: "How do you approach keyword research?", weight: 2.5, options: [ { value: 0, label: "Guess what people search" }, { value: 1, label: "Basic Google searches" }, { value: 2, label: "Free tools occasionally" }, { value: 3, label: "Regular keyword analysis" }, { value: 4, label: "Sophisticated SEO strategy" } ] }, { id: "seo_content_optimization", question: "How do you optimize content for search?", weight: 2, options: [ { value: 0, label: "Hope Google finds it" }, { value: 1, label: "Add keywords when remember" }, { value: 2, label: "Basic on-page SEO" }, { value: 3, label: "Follow SEO checklist" }, { value: 4, label: "Comprehensive optimization" } ] }, { id: "ppc_management", question: "If you run paid search, how manageable is it?", weight: 2, options: [ { value: 0, label: "Set and forget" }, { value: 1, label: "Check occasionally" }, { value: 2, label: "Weekly adjustments" }, { value: 3, label: "Regular optimization" }, { value: 4, label: "Continuous management" }, { value: -1, label: "We don't run paid search" } ] }, { id: "search_competition", question: "How well do you track competitor search strategies?", weight: 1.5, options: [ { value: 0, label: "Don't track at all" }, { value: 1, label: "Notice if we see their ads" }, { value: 2, label: "Occasional checks" }, { value: 3, label: "Regular monitoring" }, { value: 4, label: "Detailed competitive analysis" } ] }, { id: "search_performance", question: "How clear is your search ROI?", weight: 2, options: [ { value: 0, label: "No idea if it works" }, { value: 1, label: "Track traffic only" }, { value: 2, label: "Basic conversion tracking" }, { value: 3, label: "Clear ROI metrics" }, { value: 4, label: "Advanced attribution" } ] } ],
                analytics_data: [ { id: "data_collection", question: "How organized is your marketing data?", weight: 2.5, options: [ { value: 0, label: "Scattered across platforms" }, { value: 1, label: "Each tool has its own data" }, { value: 2, label: "Some central spreadsheets" }, { value: 3, label: "Dashboard pulls key metrics" }, { value: 4, label: "Unified data system" } ] }, { id: "reporting_time", question: "How long does monthly reporting take?", weight: 2.5, options: [ { value: 0, label: "Days of painful spreadsheet work" }, { value: 1, label: "Full day minimum" }, { value: 2, label: "Half day with templates" }, { value: 3, label: "Few hours" }, { value: 4, label: "Under an hour - automated" } ], benchmark: "AI-powered reporting saves 85% of time" }, { id: "insight_generation", question: "How often do you find actionable insights in your data?", weight: 2, options: [ { value: 0, label: "Data dump with no insights" }, { value: 1, label: "Rarely spot patterns" }, { value: 2, label: "Sometimes find useful things" }, { value: 3, label: "Regular insights emerge" }, { value: 4, label: "Data drives all decisions" } ] }, { id: "predictive_capability", question: "Can you predict what will work before launching?", weight: 2, options: [ { value: 0, label: "Pure guesswork" }, { value: 1, label: "Gut feeling based on experience" }, { value: 2, label: "Some historical patterns help" }, { value: 3, label: "Good success prediction" }, { value: 4, label: "Data models guide decisions" } ] }, { id: "dashboard_usefulness", question: "How useful are your current dashboards?", weight: 1.5, options: [ { value: 0, label: "What dashboards?" }, { value: 1, label: "Exist but rarely used" }, { value: 2, label: "Check them sometimes" }, { value: 3, label: "Regular reference point" }, { value: 4, label: "Drive daily decisions" } ] } ],
                paid_advertising: [ { id: "ad_creative_production", question: "How do you create ad variations?", weight: 2.5, options: [ { value: 0, label: "One ad and pray" }, { value: 1, label: "Few variations manually" }, { value: 2, label: "Designer creates options" }, { value: 3, label: "Test multiple variants" }, { value: 4, label: "Dynamic creative optimization" } ] }, { id: "campaign_optimization", question: "How do you optimize campaigns?", weight: 2.5, options: [ { value: 0, label: "Set and forget" }, { value: 1, label: "Check when remember" }, { value: 2, label: "Weekly reviews" }, { value: 3, label: "Regular optimization" }, { value: 4, label: "AI-powered optimization" } ] }, { id: "audience_targeting", question: "How sophisticated is your targeting?", weight: 2, options: [ { value: 0, label: "Basic demographics only" }, { value: 1, label: "Some interest targeting" }, { value: 2, label: "Detailed audience segments" }, { value: 3, label: "Behavioral targeting" }, { value: 4, label: "AI-powered audiences" } ] }, { id: "creative_testing", question: "How do you test what works?", weight: 2, options: [ { value: 0, label: "Don't really test" }, { value: 1, label: "Change things randomly" }, { value: 2, label: "Basic A/B tests" }, { value: 3, label: "Systematic testing" }, { value: 4, label: "Multivariate with AI" } ] }, { id: "cross_platform", question: "How well do you manage across ad platforms?", weight: 1.5, options: [ { value: 0, label: "Each platform is separate chaos" }, { value: 1, label: "Manually check each one" }, { value: 2, label: "Some coordination" }, { value: 3, label: "Unified strategy" }, { value: 4, label: "Integrated optimization" } ] } ],
                creative_design: [ { id: "design_bottleneck", question: "How often is design a bottleneck?", weight: 2.5, options: [ { value: 0, label: "Always - everything waits for design" }, { value: 1, label: "Frequently causes delays" }, { value: 2, label: "Sometimes slows things down" }, { value: 3, label: "Rarely an issue" }, { value: 4, label: "Never - very efficient" } ] }, { id: "design_requests", question: "How do you handle design requests?", weight: 2, options: [ { value: 0, label: "Chaos - no system" }, { value: 1, label: "Email and hope" }, { value: 2, label: "Basic request process" }, { value: 3, label: "Organized queue system" }, { value: 4, label: "Self-service templates" } ] }, { id: "visual_consistency", question: "How consistent is your visual brand?", weight: 2, options: [ { value: 0, label: "All over the place" }, { value: 1, label: "Try but often varies" }, { value: 2, label: "Mostly consistent" }, { value: 3, label: "Strong guidelines followed" }, { value: 4, label: "Perfect brand consistency" } ] }, { id: "design_tools", question: "What design tools does your team use?", weight: 1.5, options: [ { value: 0, label: "PowerPoint and prayers" }, { value: 1, label: "Basic free tools" }, { value: 2, label: "Mix of tools" }, { value: 3, label: "Professional tools" }, { value: 4, label: "Advanced design stack" } ] }, { id: "design_ai_interest", question: "How interested are you in AI design tools?", weight: 3, options: [ { value: 0, label: "Worried about quality" }, { value: 1, label: "Skeptical but curious" }, { value: 3, label: "Very interested" }, { value: 4, label: "Already experimenting" }, { value: 5, label: "Using AI design daily" } ] } ],
                marketing_automation: [ { id: "automation_maturity", question: "How automated are your marketing workflows?", weight: 3, options: [ { value: 0, label: "Everything is manual" }, { value: 1, label: "Very basic automation" }, { value: 2, label: "Key workflows automated" }, { value: 3, label: "Most processes automated" }, { value: 4, label: "Sophisticated automation" } ] }, { id: "lead_nurturing", question: "How do you nurture leads?", weight: 2.5, options: [ { value: 0, label: "We don't really" }, { value: 1, label: "Occasional manual emails" }, { value: 2, label: "Basic drip campaign" }, { value: 3, label: "Segmented nurture flows" }, { value: 4, label: "AI-powered nurturing" } ] }, { id: "personalization_level", question: "How personalized are your automated messages?", weight: 2, options: [ { value: 0, label: "Same for everyone" }, { value: 1, label: "Name only" }, { value: 2, label: "Basic segments" }, { value: 3, label: "Behavior-based" }, { value: 4, label: "Individual level" } ] }, { id: "workflow_complexity", question: "How complex can your workflows get?", weight: 1.5, options: [ { value: 0, label: "Linear only" }, { value: 1, label: "Simple branches" }, { value: 2, label: "Multiple paths" }, { value: 3, label: "Complex logic" }, { value: 4, label: "AI-driven flows" } ] }, { id: "automation_roi", question: "Can you measure automation impact?", weight: 2, options: [ { value: 0, label: "No idea" }, { value: 1, label: "Assume it helps" }, { value: 2, label: "Some metrics" }, { value: 3, label: "Clear ROI" }, { value: 4, label: "Detailed attribution" } ] } ]
            },
            scoringDimensions: { 
                humanReadiness: { weight: 0.4, categories: ["champions", "leadership", "resources"] }, 
                technicalReadiness: { weight: 0.3, categories: ["readiness"] }, 
                activityAutomation: { weight: 0.3, activities: "selected" } 
            },
            sizeModifiers: { 
                solo: { timeValue: 50, focusAreas: ["efficiency", "quick_wins"], budgetRange: "0-100" }, 
                small: { timeValue: 150, focusAreas: ["collaboration", "scalability"], budgetRange: "100-500" }, 
                medium: { timeValue: 400, focusAreas: ["transformation", "competitive_advantage"], budgetRange: "500-2000" } 
            }
        };

        // Scoring Classes
        class AgencyTransformationScoring {
            constructor(config = {}) { 
                this.config = config; 
                this.transformationWeights = config.dimensions || { transformation: 0.25, resources: 0.20, leadership: 0.20, change: 0.35 }; 
                this.valuationWeights = config.valuationDimensions || { financial: 0.35, operational: 0.30, strategic: 0.20, ai: 0.15 }; 
                this.serviceVulnerability = config.serviceVulnerabilityWeights || { content_creation: 85, seo_sem: 80, digital_marketing: 75, creative_design: 65, pr_comms: 60, video_production: 55, strategy_consulting: 35 }; 
            }
            
            calculateScores(answers, metadata) {
                const { selectedServices = [], agencySize, revenue, agencyType } = metadata;
                const dimensionScores = this.calculateDimensionScores(answers);
                const valuationDimensions = this.calculateValuationDimensions(answers, dimensionScores, metadata);
                const serviceScores = this.calculateServiceScores(answers, selectedServices);
                const serviceVulnerability = this.calculateOverallServiceVulnerability(serviceScores, selectedServices);
                const serviceAdaptability = this.calculateServiceAdaptability(serviceScores);
                const transformationScore = this.calculateTransformationScore(dimensionScores);
                const valuationScore = this.calculateValuationScore(valuationDimensions, serviceVulnerability);
                const overallScore = (transformationScore * 0.6) + (valuationScore * 0.4);
                const readinessCategory = this.getReadinessCategory(transformationScore);
                const valuationCategory = this.getValuationCategory(valuationScore);
                const keyInsights = this.extractKeyInsights(dimensionScores, valuationDimensions, serviceScores, answers);
                const riskFactors = this.calculateRiskFactors(answers, serviceScores, metadata);
                const clientConcentration = answers.cr_6?.score || answers.cr_6 || 3;
                
                return { 
                    overall: Math.round(overallScore), 
                    transformation: Math.round(transformationScore), 
                    valuation: Math.round(valuationScore), 
                    dimensions: { 
                        transformation: Math.round(dimensionScores.transformation), 
                        resources: Math.round(dimensionScores.resources), 
                        leadership: Math.round(dimensionScores.leadership), 
                        change: Math.round(dimensionScores.change) 
                    }, 
                    valuationDimensions: { 
                        financial: Math.round(valuationDimensions.financial), 
                        operational: Math.round(valuationDimensions.operational), 
                        strategic: Math.round(valuationDimensions.strategic), 
                        ai: Math.round(valuationDimensions.ai) 
                    }, 
                    serviceScores, 
                    serviceVulnerability: Math.round(serviceVulnerability), 
                    serviceAdaptability: Math.round(serviceAdaptability), 
                    categories: { readiness: readinessCategory, valuation: valuationCategory }, 
                    riskFactors, 
                    keyInsights, 
                    clientConcentration, 
                    metadata: { agencySize, revenue, agencyType, selectedServices, questionCount: Object.keys(answers).length, timestamp: new Date().toISOString() } 
                };
            }
            
            calculateDimensionScores(answers) {
                const dimensions = { transformation: [], resources: [], leadership: [], change: [] };
                Object.entries(answers).forEach(([questionId, answer]) => {
                    let dimension;
                    if (questionId.startsWith('tc_')) dimension = 'transformation';
                    else if (questionId.startsWith('rc_')) dimension = 'resources';
                    else if (questionId.startsWith('lc_')) dimension = 'leadership';
                    else if (questionId.startsWith('cr_')) dimension = 'change';
                    
                    if (dimension && dimensions[dimension]) { 
                        const score = typeof answer === 'object' ? (answer.score || 0) : (typeof answer === 'number' ? answer : 0); 
                        dimensions[dimension].push(score); 
                    }
                });
                
                const dimensionScores = {};
                Object.entries(dimensions).forEach(([dimension, scores]) => { 
                    if (scores.length > 0) { 
                        const sum = scores.reduce((a, b) => a + b, 0); 
                        dimensionScores[dimension] = (sum / scores.length - 1) * 25; 
                    } else { 
                        dimensionScores[dimension] = 50; 
                    } 
                });
                
                return dimensionScores;
            }
            
            calculateValuationDimensions(answers, dimensionScores, metadata) {
                const valuationDimensions = { financial: 0, operational: 0, strategic: 0, ai: 0 };
                const getScore = (qId) => answers[qId]?.score || (typeof answers[qId] === 'number' ? answers[qId] : null);
                
                const financialQuestions = ['rc_1', 'rc_4', 'lc_4', 'cr_6'];
                const financialScores = financialQuestions.map(getScore).filter(s => s !== null);
                if (financialScores.length > 0) valuationDimensions.financial = ((financialScores.reduce((a, b) => a + b, 0) / financialScores.length) - 1) * 25;
                else if (metadata.revenue) {
                    const revenueMap = {"under-500k":1, "500k-1m":2, "1m-2.5m":3, "2.5m-5m":4, "5m-10m":5, "10m+":5};
                    valuationDimensions.financial = ((revenueMap[metadata.revenue] || 3) -1) * 25;
                }

                const operationalQuestions = ['tc_2', 'tc_4', 'rc_2', 'lc_2', 'cr_1', 'cr_4'];
                const operationalScores = operationalQuestions.map(getScore).filter(s => s !== null);
                if (operationalScores.length > 0) valuationDimensions.operational = ((operationalScores.reduce((a, b) => a + b, 0) / operationalScores.length) - 1) * 25;

                const strategicQuestions = ['tc_5', 'lc_1', 'lc_3', 'lc_5', 'cr_3'];
                const strategicScores = strategicQuestions.map(getScore).filter(s => s !== null);
                if (strategicScores.length > 0) valuationDimensions.strategic = ((strategicScores.reduce((a, b) => a + b, 0) / strategicScores.length) - 1) * 25;
                
                const aiScoreFromCr2 = getScore('cr_2');
                valuationDimensions.ai = (dimensionScores.transformation * 0.7) + ((aiScoreFromCr2 !== null ? aiScoreFromCr2 : 3) - 1) * 25 * 0.3;
                
                return valuationDimensions;
            }
            
            calculateServiceScores(answers, selectedServices) {
                const serviceScores = {};
                selectedServices.forEach(service => {
                    const serviceQuestions = AgencyQuestionsConfig.serviceQuestions[service]?.questions || [];
                    const serviceAnswers = [];
                    
                    serviceQuestions.forEach(q => {
                        const answer = answers[q.id];
                        if (answer !== undefined && answer !== null) {
                            const score = typeof answer === 'object' ? (answer.score || 0) : (typeof answer === 'number' ? answer : 0);
                            serviceAnswers.push(score);
                        }
                    });

                    if (serviceAnswers.length > 0) {
                        const avgScore = serviceAnswers.reduce((a, b) => a + b, 0) / serviceAnswers.length;
                        const normalizedScore = ((avgScore - 1) / 4) * 100;
                        
                        const aiOpportunityQuestion = serviceQuestions.find(q => q.dimension === "service_ai_opportunity");
                        const aiOpportunityAnswer = aiOpportunityQuestion ? answers[aiOpportunityQuestion.id] : undefined;
                        const aiOpportunityScore = aiOpportunityAnswer !== undefined ? 
                            (typeof aiOpportunityAnswer === 'object' ? (aiOpportunityAnswer.score || 3) : (typeof aiOpportunityAnswer === 'number' ? aiOpportunityAnswer : 3)) : 3;
                        const aiOpportunity = ((aiOpportunityScore - 1) / 4) * 100;
                        
                        serviceScores[service] = { 
                            score: Math.round(normalizedScore), 
                            vulnerability: this.serviceVulnerability[service] || 50, 
                            adaptability: Math.round(100 - (this.serviceVulnerability[service] || 50) + (normalizedScore * 0.3)), 
                            aiOpportunity: Math.round(aiOpportunity), 
                            readiness: normalizedScore > 60 ? 'high' : normalizedScore > 40 ? 'medium' : 'low' 
                        };
                    }
                });
                
                return serviceScores;
            }
            
            calculateOverallServiceVulnerability(serviceScores, selectedServices) { 
                if (selectedServices.length === 0) return 50; 
                let totalVulnerability = 0; 
                let totalWeight = 0; 
                selectedServices.forEach(service => { 
                    const score = serviceScores[service]; 
                    if (score) { 
                        const weight = score.readiness === 'low' ? 1.5 : score.readiness === 'medium' ? 1.0 : 0.7; 
                        totalVulnerability += score.vulnerability * weight; 
                        totalWeight += weight; 
                    } 
                }); 
                return totalWeight > 0 ? totalVulnerability / totalWeight : 50; 
            }
            
            calculateServiceAdaptability(serviceScores) { 
                const adaptabilityScores = Object.values(serviceScores).map(s => s.adaptability).filter(s => s !== undefined); 
                if (adaptabilityScores.length === 0) return 50; 
                return adaptabilityScores.reduce((a, b) => a + b, 0) / adaptabilityScores.length; 
            }
            
            calculateTransformationScore(dimensionScores) { 
                let weightedSum = 0; 
                let totalWeight = 0; 
                Object.entries(this.transformationWeights).forEach(([dimension, weight]) => { 
                    if (dimensionScores[dimension] !== undefined) { 
                        weightedSum += dimensionScores[dimension] * weight; 
                        totalWeight += weight; 
                    } 
                }); 
                return totalWeight > 0 ? weightedSum / totalWeight : 50; 
            }
            
            calculateValuationScore(valuationDimensions, serviceVulnerability) { 
                let weightedSum = 0; 
                let totalWeight = 0; 
                Object.entries(this.valuationWeights).forEach(([dimension, weight]) => { 
                    if (valuationDimensions[dimension] !== undefined) { 
                        weightedSum += valuationDimensions[dimension] * weight; 
                        totalWeight += weight; 
                    } 
                }); 
                const baseScore = totalWeight > 0 ? weightedSum / totalWeight : 50; 
                const vulnerabilityAdjustment = (100 - serviceVulnerability) * 0.2; 
                return baseScore * 0.8 + vulnerabilityAdjustment; 
            }
            
            getReadinessCategory(score) { 
                if (score >= 75) return { level: 'high', label: 'Transformation Leader', color: '#00AA00' }; 
                if (score >= 60) return { level: 'good', label: 'Well Positioned', color: '#88CC00' }; 
                if (score >= 40) return { level: 'moderate', label: 'Getting Ready', color: '#FFAA00' }; 
                if (score >= 25) return { level: 'low', label: 'Early Stage', color: '#FF8800' }; 
                return { level: 'critical', label: 'Urgent Action Needed', color: '#FF4444' }; 
            }
            
            getValuationCategory(score) { 
                if (score >= 75) return { level: 'premium', label: 'Premium Valuation', multiple: '6-8x EBITDA', color: '#00AA00' }; 
                if (score >= 60) return { level: 'strong', label: 'Strong Valuation', multiple: '5-6x EBITDA', color: '#88CC00' }; 
                if (score >= 40) return { level: 'average', label: 'Market Valuation', multiple: '3.5-5x EBITDA', color: '#FFAA00' }; 
                if (score >= 25) return { level: 'below', label: 'Below Market', multiple: '2.5-3.5x EBITDA', color: '#FF8800' }; 
                return { level: 'distressed', label: 'Distressed', multiple: '1-2.5x EBITDA', color: '#FF4444' }; 
            }
            
            calculateRiskFactors(answers, serviceScores, metadata) {
                const risks = [];
                const clientConcentration = answers.cr_6?.score || (typeof answers.cr_6 === 'number' ? answers.cr_6 : 3);
                if (clientConcentration <= 2) risks.push({ factor: 'Client Concentration', severity: 'high', impact: '-1.0x multiple', description: 'Major client represents >30% of revenue' });
                
                const revenuePredictability = answers.rc_4?.score || (typeof answers.rc_4 === 'number' ? answers.rc_4 : 3);
                if (revenuePredictability <= 2) risks.push({ factor: 'Revenue Volatility', severity: 'high', impact: '-0.5x multiple', description: 'Unpredictable project-based revenue' });
                
                const keyPerson = answers.cr_4?.score || (typeof answers.cr_4 === 'number' ? answers.cr_4 : 3);
                if (keyPerson <= 2) risks.push({ factor: 'Key Person Risk', severity: 'medium', impact: '-0.5x multiple', description: 'Critical knowledge not documented' });
                
                const highVulnerabilityServices = Object.entries(serviceScores).filter(([_, score]) => score.vulnerability > 75).map(([service]) => AgencyQuestionsConfig.serviceQuestions[service]?.serviceName || service);
                if (highVulnerabilityServices.length > 0) risks.push({ factor: 'Service Disruption', severity: 'high', impact: '-0.5-1.0x multiple', description: `High AI vulnerability in ${highVulnerabilityServices.join(', ')}` });
                
                const aiReadiness = answers.cr_2?.score || (typeof answers.cr_2 === 'number' ? answers.cr_2 : 3);
                if (aiReadiness <= 2) risks.push({ factor: 'Technology Gap', severity: 'medium', impact: '-0.5x multiple', description: 'Limited AI adoption vs competitors' });
                
                return risks;
            }
            
            extractKeyInsights(dimensionScores, valuationDimensions, serviceScores, answers) {
                const insights = [];
                if (dimensionScores.transformation > 70) insights.push({ type: 'strength', message: 'Strong AI foundation positions you ahead of 80% of agencies' });
                else if (dimensionScores.transformation < 40) insights.push({ type: 'risk', message: 'Limited AI adoption creates immediate competitive risk' });
                
                if (dimensionScores.resources > 60) insights.push({ type: 'strength', message: 'Available resources enable rapid transformation' });
                else if (dimensionScores.resources < 30) insights.push({ type: 'constraint', message: 'Resource constraints require phased approach' });
                
                return insights.slice(0,3);
            }
        }

        // Recommendations Classes
        class AgencyRecommendationsEngine {
            constructor(config = {}) { this.config = config; }
            
            generateRecommendations(assessmentData) {
                const { scores, answers, selectedServices, agencySize, revenue } = assessmentData;
                const priority = this.calculatePriority(scores);
                return { 
                    immediate: this.getImmediateActions(scores, priority, selectedServices, agencySize, answers), 
                    shortTerm: this.getShortTermActions(scores, priority, selectedServices, revenue, answers), 
                    strategic: this.getStrategicActions(scores, priority, selectedServices, answers), 
                    valuationImpact: this.getValuationImpactSummary(scores, selectedServices, answers), 
                    quickWins: this.getQuickWins(scores, selectedServices, agencySize, answers), 
                    transformationRoadmap: this.getTransformationRoadmap(scores, priority) 
                };
            }
            
            calculatePriority(scores) { 
                const priorities = []; 
                if (scores.dimensions.transformation < 40) priorities.push('ai_capability_building'); 
                if (scores.dimensions.resources < 40) priorities.push('resource_optimization'); 
                if (scores.dimensions.leadership < 40) priorities.push('leadership_alignment'); 
                if (scores.dimensions.change < 40) priorities.push('change_readiness'); 
                if (scores.valuationDimensions.financial < 40) priorities.push('financial_stability'); 
                if (scores.serviceVulnerability > 70) priorities.push('service_transformation'); 
                return priorities; 
            }
            
            getImmediateActions(scores, priority, selectedServices, agencySize, answers) {
                const actions = [];
                if (scores.overall < 40) { 
                    actions.push({ 
                        title: "AI Literacy Bootcamp", 
                        description: "Get your entire team on ChatGPT or Claude this week. Schedule a 2-hour hands-on session where everyone creates something relevant to their role.", 
                        effort: "2 hours", 
                        impact: "Foundation for all AI adoption", 
                        category: "capability", 
                        difficulty: "easy" 
                    }); 
                    actions.push({ 
                        title: "Identify Your AI Champions", 
                        description: "Find the 2-3 people already experimenting with AI tools. Give them 4 hours/week to test tools and share findings.", 
                        effort: "30 mins + 4 hrs/wk", 
                        impact: "Accelerates adoption by 3x", 
                        category: "team", 
                        difficulty: "easy" 
                    }); 
                }
                else if (scores.overall < 70) { 
                    actions.push({ 
                        title: "AI Tool Audit", 
                        description: "List every repetitive task. Test AI tools for the top 5 time-wasters. Document what works.", 
                        effort: "1 day", 
                        impact: "Identifies 10-20 hrs/wk savings", 
                        category: "efficiency", 
                        difficulty: "medium" 
                    }); 
                    actions.push({ 
                        title: "Client AI Conversation", 
                        description: "Talk to your top 3 clients about AI. Ask what they're seeing, concerns, excitement.", 
                        effort: "3 one-hour calls", 
                        impact: "Shapes service evolution", 
                        category: "strategy", 
                        difficulty: "easy" 
                    }); 
                }
                else { 
                    actions.push({ 
                        title: "AI Service Packaging", 
                        description: "Create an 'AI-Enhanced' tier for your top service. Price it 30% higher, deliver 2x faster.", 
                        effort: "2 days to design", 
                        impact: "+30% revenue per project", 
                        category: "revenue", 
                        difficulty: "medium" 
                    }); 
                    actions.push({ 
                        title: "Thought Leadership Sprint", 
                        description: "Share your AI journey publicly. Write 3 LinkedIn posts about what's working, lessons learned, results.", 
                        effort: "3 hours", 
                        impact: "Positions you as innovator", 
                        category: "marketing", 
                        difficulty: "easy" 
                    }); 
                }
                
                if (selectedServices.includes('content_creation') && scores.serviceScores?.content_creation?.vulnerability > 70) {
                    actions.push({ 
                        title: "Content AI Pilot", 
                        description: "This week: Use Claude/ChatGPT to draft your next 5 blog posts. Time it. Calculate time saved.", 
                        effort: "5 hours", 
                        impact: "40-60% time savings proven", 
                        category: "service", 
                        difficulty: "easy", 
                        service: "content_creation" 
                    });
                }
                
                if (scores.valuationDimensions.financial < 40 && (answers.cr_6?.score || answers.cr_6 || 3) <= 2) {
                    actions.push({ 
                        title: "Revenue Concentration Fix", 
                        description: "Your biggest client is over 30% of revenue. This week: List 10 similar companies. Reach out to 3.", 
                        effort: "1 day", 
                        impact: "Reduces critical risk", 
                        category: "financial", 
                        difficulty: "medium", 
                        valuationImpact: "+0.5-1.0x EBITDA multiple" 
                    });
                }
                
                return actions.slice(0, 3);
            }
            
            getShortTermActions(scores, priority, selectedServices, revenue, answers) {
                const actions = [];
                if (scores.dimensions.transformation < 60) { 
                    actions.push({ 
                        title: "AI Workflow Documentation", 
                        description: "Document new AI-enhanced processes. Create 1-page guides for each tool.", 
                        effort: "2 days total", 
                        impact: "Scales AI adoption", 
                        timeline: "Next 60 days", 
                        category: "operations" 
                    }); 
                    actions.push({ 
                        title: "Team Upskilling Program", 
                        description: "Dedicate 2 hours every Friday to AI skills. Prompting, tools, integration, impact.", 
                        effort: "2 hours/week", 
                        impact: "Builds sustainable capability", 
                        timeline: "Next 4 weeks", 
                        category: "team" 
                    }); 
                }
                
                const annualRevenue = AgencyQuestionsConfig.qualifying.find(q=>q.id==='annual_revenue')?.options.find(o=>o.value === (answers.annual_revenue_value || revenue))?.score || 3;
                if (annualRevenue < 3) {
                    actions.push({ 
                        title: "Retainer Conversion Campaign", 
                        description: "Convert project clients to retainers. Offer 10% discount for 6-month commitments.", 
                        effort: "1 wk plan, 2 wks exec", 
                        impact: "+20% predictable revenue", 
                        timeline: "Next 30 days", 
                        category: "financial", 
                        valuationImpact: "+0.5x EBITDA multiple" 
                    });
                }
                
                return actions.slice(0, 2);
            }
            
            getStrategicActions(scores, priority, selectedServices, answers) {
                const actions = [];
                if (scores.overall > 70) {
                    actions.push({ 
                        title: "AI-First Service Revolution", 
                        description: "Redesign all services with AI at the core. Deliver 10x value at premium prices.", 
                        timeline: "6-month transformation", 
                        impact: "Market leadership", 
                        complexity: "high", 
                        category: "strategy" 
                    });
                }
                else if (scores.overall > 40) {
                    actions.push({ 
                        title: "Selective AI Excellence", 
                        description: "Pick 2 services where AI gives biggest advantage. Become best-in-class.", 
                        timeline: "6 months", 
                        impact: "Clear differentiation", 
                        complexity: "medium", 
                        category: "strategy" 
                    });
                }
                else {
                    actions.push({ 
                        title: "Survival Transformation", 
                        description: "This is existential. Consider: Merge, pivot, or radical upskilling.", 
                        timeline: "Decide in 3 months", 
                        impact: "Business continuity", 
                        complexity: "high", 
                        category: "survival" 
                    });
                }
                return actions.slice(0, 1);
            }
            
            getQuickWins(scores, selectedServices, agencySize, answers) {
                const wins = [];
                wins.push({ 
                    title: "Email Writing Speed-Up", 
                    action: "Use Claude/ChatGPT for all client emails tomorrow", 
                    time: "Save 30 mins/day", 
                    difficulty: "trivial" 
                });
                wins.push({ 
                    title: "Meeting Notes Automation", 
                    action: "Record calls, use AI for summary and action items", 
                    time: "Save 2 hours/week", 
                    difficulty: "easy" 
                });
                if (selectedServices.includes('content_creation')) {
                    wins.push({ 
                        title: "Blog Post Outlining", 
                        action: "AI creates outlines from keywords in 30 seconds", 
                        time: "Save 45 mins per post", 
                        difficulty: "trivial", 
                        service: "content" 
                    });
                }
                return wins.slice(0, 3);
            }
            
            getTransformationRoadmap(scores, priority) { 
                const phase1Duration = scores.overall < 40 ? "30 days" : "60 days"; 
                const phase2Duration = scores.overall < 40 ? "60 days" : "90 days"; 
                const phase3Duration = "6 months"; 
                return { 
                    phase1: { 
                        title: "Foundation Building", 
                        duration: phase1Duration, 
                        focus: "Emergency upskilling & quick wins", 
                        milestones: ["All team using 1 AI tool", "3 processes AI-integrated", "First client success"] 
                    }, 
                    phase2: { 
                        title: "Capability Expansion", 
                        duration: phase2Duration, 
                        focus: "Scale experiments & build capability", 
                        milestones: ["50% time reduction in 1 service", "AI-enhanced service tier launched"] 
                    }, 
                    phase3: { 
                        title: "Transformation Leadership", 
                        duration: phase3Duration, 
                        focus: "Embed AI as competitive advantage", 
                        milestones: ["AI across all services", "New AI-native service launched"] 
                    } 
                }; 
            }
            
            getValuationImpactSummary(scores, selectedServices, answers) { 
                const currentMultiple = this.estimateCurrentMultiple(scores); 
                const potentialMultiple = this.estimatePotentialMultiple(scores); 
                const multipleDelta = potentialMultiple - currentMultiple; 
                const improvements = []; 
                
                if (scores.valuationDimensions.financial < 60) {
                    improvements.push({ 
                        action: "Improve revenue predictability", 
                        impact: "+0.5-1.0x multiple", 
                        howTo: "Convert to 40%+ recurring revenue" 
                    });
                }
                
                if ((answers.cr_6?.score || answers.cr_6 || 3) <= 2) {
                    improvements.push({ 
                        action: "Reduce client concentration", 
                        impact: "+0.5x multiple", 
                        howTo: "No client over 20% of revenue" 
                    });
                }
                
                return { 
                    currentEstimate: `${currentMultiple.toFixed(1)}x EBITDA`, 
                    potentialEstimate: `${potentialMultiple.toFixed(1)}x EBITDA`, 
                    totalUplift: `+${multipleDelta.toFixed(1)}x`, 
                    improvements: improvements.slice(0,2), 
                    timeframe: "12-18 months" 
                }; 
            }
            
            estimateCurrentMultiple(scores) { 
                let baseMultiple = 3.5; 
                if (scores.valuationDimensions.financial > 70) baseMultiple += 1.0; 
                else if (scores.valuationDimensions.financial < 40) baseMultiple -= 1.0; 
                if (scores.valuationDimensions.operational > 70) baseMultiple += 0.5; 
                else if (scores.valuationDimensions.operational < 40) baseMultiple -= 0.5; 
                if (scores.dimensions.transformation > 70) baseMultiple += 0.5; 
                if (scores.serviceVulnerability > 70) baseMultiple -= 0.5; 
                return Math.max(1.5, Math.min(6.0, baseMultiple)); 
            }
            
            estimatePotentialMultiple(scores) { 
                let potentialMultiple = this.estimateCurrentMultiple(scores); 
                if (scores.valuationDimensions.financial < 60) potentialMultiple += 0.75; 
                if (scores.dimensions.transformation < 60) potentialMultiple += 1.0; 
                if (scores.serviceVulnerability > 60) potentialMultiple += 0.75; 
                return Math.min(8.0, potentialMultiple); 
            }
        }

        class InhouseRecommendationsEngineV3 {
            constructor(assessmentData) { 
                this.assessment = assessmentData; 
                this.marketInsights = InHouseMarketingAssessment.marketBenchmarks;
            }
            
            generateRecommendations(scores, responses) { 
                const companySize = responses.team_size || 'small'; 
                const selectedActivities = Object.keys(window.userData.services).filter(act => window.userData.services[act]); 
                return { 
                    executiveSummary: this.generateExecutiveSummary(scores, responses), 
                    marketPosition: this.analyzeMarketPosition(scores, companySize), 
                    transformationOpportunities: this.identifyOpportunities(scores, responses), 
                    quickWins: this.generateQuickWins(scores, responses, selectedActivities), 
                    strategicRoadmap: this.buildRoadmap(scores, responses), 
                    teamReadiness: this.assessTeamReadiness(scores, responses), 
                    implementationPath: this.createImplementationPath(scores, responses), 
                    expectedOutcomes: this.projectOutcomes(scores, companySize, selectedActivities), 
                    nextSteps: this.defineNextSteps(scores, responses) 
                }; 
            }
            
            generateExecutiveSummary(scores, responses) { 
                const size = responses.team_size || 'small'; 
                const overallScore = scores.overall || 0; 
                const marketAvg = this.getMarketAverage(size); 
                const position = overallScore > marketAvg ? 'ahead' : 'behind'; 
                const gap = Math.abs(overallScore - marketAvg); 
                const biggestGap = this.findBiggestGap(scores); 
                return { 
                    headline: this.getHeadline(overallScore, position), 
                    marketContext: `You're ${gap} points ${position} similar ${size} marketing teams. ${this.marketInsights.adoption[2024].marketing}% are actively adopting AI.`, 
                    criticalInsight: this.getCriticalInsight(biggestGap, responses), 
                    bottomLine: this.getBottomLine(scores, responses) 
                }; 
            }
            
            analyzeMarketPosition(scores, companySize) { 
                const benchmarks = { 
                    solo: { bottom: 25, average: 40, top: 65 }, 
                    small: { bottom: 35, average: 50, top: 75 }, 
                    medium: { bottom: 45, average: 60, top: 85 } 
                }; 
                const benchmark = benchmarks[companySize] || benchmarks.small; 
                const score = scores.overall; 
                let quartile, message, implication; 
                
                if (score >= benchmark.top) { 
                    quartile = "Top 25%"; 
                    message = "You're ahead of the curve"; 
                    implication = "Focus on extending your lead"; 
                } else if (score >= benchmark.average) { 
                    quartile = "Above Average"; 
                    message = "You're keeping pace"; 
                    implication = "Key opportunities to jump ahead"; 
                } else { 
                    quartile = "Below Average"; 
                    message = "You're falling behind"; 
                    implication = "Urgent action needed"; 
                } 
                
                return { 
                    quartile, 
                    message, 
                    implication, 
                    competitorActions: "Competitors are adopting AI rapidly.", 
                    timeToAct: "Act within 3 months." 
                }; 
            }
            
            identifyOpportunities(scores, responses) { 
                const opportunities = []; 
                if (scores.dimensions.humanReadiness < 50) {
                    opportunities.push({ 
                        area: "Team Transformation", 
                        insight: "Team shows readiness but lacks direction", 
                        data: "Teams with AI champions are 3x more likely to succeed", 
                        action: "Identify and empower an AI champion" 
                    });
                }
                if (scores.dimensions.technicalReadiness < 60) {
                    opportunities.push({ 
                        area: "Process Evolution", 
                        insight: "Processes can be dramatically streamlined", 
                        data: `${this.marketInsights.productivity.reporting.avg}% time savings in reporting`, 
                        action: "Start with your most repetitive task" 
                    });
                }
                return opportunities.slice(0,2); 
            }
            
            generateQuickWins(scores, responses, activities) { 
                const wins = []; 
                if (activities.includes('content_marketing') && (scores.activityScores?.content_marketing?.score || 50) < 50) {
                    wins.push({ 
                        title: "Transform Content Creation", 
                        why: "Content creation is consuming time", 
                        how: "Use AI for first drafts - 70% time savings", 
                        specificAction: "Write next blog post with Claude/ChatGPT", 
                        expectedResult: "Save 2-3 hours per piece", 
                        marketContext: "84% of teams use AI for content", 
                        investment: "Free to start" 
                    });
                }
                if ((responses.champion_identification || 0) < 3) {
                    wins.push({ 
                        title: "Identify Your AI Champion", 
                        why: "Someone on your team is AI-curious", 
                        how: "Ask 'Who wants to experiment with AI?'", 
                        specificAction: "Give them 2 hours this week to explore", 
                        expectedResult: "Natural leader emerges", 
                        marketContext: "72% of transformations start with a champion", 
                        investment: "Time only" 
                    });
                }
                return wins.slice(0, 3); 
            }
            
            buildRoadmap(scores, responses) { 
                const companySize = responses.team_size || 'small'; 
                const timeline = this.marketInsights.transformation[companySize]?.timeline || "3-6 months"; 
                return { 
                    overview: `Your ${timeline} transformation journey`, 
                    phase1: { 
                        name: "Foundation (Days 1-30)", 
                        focus: "Quick wins & champion development", 
                        actions: ["Implement 2-3 quick wins", "Identify AI champion(s)"], 
                        expectedOutcome: "20-30% time savings" 
                    }, 
                    phase2: { 
                        name: "Acceleration (Days 31-60)", 
                        focus: "Scale successful experiments", 
                        actions: ["Roll out AI tools to team", "Establish quality guidelines"], 
                        expectedOutcome: "40-50% productivity gain" 
                    }, 
                    phase3: { 
                        name: "Transformation (Days 61-90)", 
                        focus: "Embed AI as competitive advantage", 
                        actions: ["Optimize all core activities", "Develop team expertise"], 
                        expectedOutcome: "2-3x output" 
                    }, 
                    investmentGuide: this.marketInsights.transformation[companySize]?.budget || "£100-500/month" 
                }; 
            }
            
            assessTeamReadiness(scores, responses) { 
                const strengths = []; 
                const gaps = []; 
                if ((responses.knowledge_sharing || 0) >= 3) {
                    strengths.push({ 
                        area: "Knowledge Sharing Culture", 
                        insight: "Team shares learnings - critical for AI", 
                        leverage: "Build on this with AI experiment sharing" 
                    });
                }
                if ((responses.process_documentation || 0) < 2) {
                    gaps.push({ 
                        area: "Process Documentation", 
                        insight: "Undocumented processes hinder AI", 
                        fix: "Document top 3 workflows", 
                        impact: "3x faster AI implementation" 
                    });
                }
                return { 
                    strengths, 
                    gaps, 
                    recommendations: ["Start with volunteers", "Celebrate learning"], 
                    overallReadiness: scores.overall >= 70 ? "High" : scores.overall >=50 ? "Moderate" : "Developing" 
                }; 
            }
            
            createImplementationPath(scores, responses) { 
                const companySize = responses.team_size || 'small'; 
                const budget = this.marketInsights.transformation[companySize]?.budget || "£100-500/month"; 
                return { 
                    week1: { 
                        title: "Proof of Concept", 
                        actions: ["Try one AI tool for biggest pain point"], 
                        success: "One clear win" 
                    }, 
                    month2: { 
                        title: "Systematic Implementation", 
                        actions: ["Roll out across priority activities"], 
                        success: "AI embedded in daily work" 
                    }, 
                    budget, 
                    warning: "Don't try everything at once" 
                }; 
            }
            
            projectOutcomes(scores, companySize, activities) { 
                const baselineHours = {solo: 50, small: 120, medium: 320}[companySize] || 120; 
                const avgSaving = activities.length > 0 ? 
                    activities.reduce((sum, act) => sum + (this.marketInsights.productivity[act]?.avg || 40), 0) / activities.length : 40; 
                const hoursSaved = Math.round(baselineHours * (avgSaving / 100)); 
                
                return { 
                    headline: `Save ${hoursSaved} hours weekly (${Math.round(avgSaving)}% productivity gain)`, 
                    details: { 
                        timeSavings: `${hoursSaved} hours/week`, 
                        outputIncrease: "2-3x content volume" 
                    }, 
                    timeline: { 
                        month1: "20-30% gain", 
                        month3: "50-70% gain" 
                    }, 
                    roi: `Typical ROI: ${this.marketInsights.roi.multiplier}` 
                }; 
            }
            
            defineNextSteps(scores, responses) { 
                return { 
                    immediate: { 
                        today: "Share report with team", 
                        tomorrow: "Try one AI tool" 
                    }, 
                    callToAction: { 
                        primary: "Ready to accelerate?", 
                        value: "Get your 90-day QuickMap.ai roadmap", 
                        cta: "Book QuickMap Session" 
                    } 
                }; 
            }
            
            getMarketAverage(size) { 
                return { solo: 40, small: 50, medium: 60, large: 70 }[size] || 50; 
            }
            
            findBiggestGap(scores) { 
                const dimensions = scores.dimensions || {}; 
                let biggest = { dimension: 'humanReadiness', gap: 100-(scores.dimensions?.humanReadiness || 0) }; 
                Object.entries(dimensions).forEach(([dim, score]) => { 
                    const gap = 100 - score; 
                    if (gap > biggest.gap) biggest = { dimension: dim, gap, score }; 
                }); 
                return biggest; 
            }
            
            getHeadline(score, position) { 
                if (score >= 70) return "You're ahead - let's extend your lead"; 
                if (score >= 50) return "Key pieces in place - time to connect them"; 
                return "Significant opportunity to leapfrog competitors"; 
            }
            
            getCriticalInsight(biggestGap, responses) { 
                return { 
                    humanReadiness: "Team ready but lacks tools/direction", 
                    technicalReadiness: "Tools exist but need strategic connection", 
                    activityAutomation: "Activities ripe for AI transformation" 
                }[biggestGap.dimension] || "Multiple opportunities for improvement"; 
            }
            
            getBottomLine(scores, responses) { 
                const size = responses.team_size || 'small'; 
                const potentialHours = Math.round(({solo: 50, small: 120, medium: 320}[size] || 120) * ((100 - (scores.overall || 0)) / 100) * 0.4); 
                return `With focused effort over ${this.marketInsights.transformation[size]?.timeline || "3-6 months"}, you could save ${potentialHours} hours weekly. Investment: ${this.marketInsights.transformation[size]?.budget || "£100-500/month"}.`; 
            }
        }

        // Report Generation Class
        class TransformationReport {
            constructor(config = {}) { this.config = config; }
            
            generateReport(scores, recommendations, metadata, assessmentType = 'agency') {
                const reportData = {
                    executive: this.generateExecutiveSummary(scores, recommendations, metadata, assessmentType),
                    readiness: this.generateReadinessSection(scores, assessmentType),
                    opportunities: this.generateOpportunitiesSection(scores, recommendations, assessmentType),
                    roadmap: this.generateRoadmapSection(recommendations, assessmentType),
                    impact: this.generateImpactSection(scores, metadata, assessmentType),
                    nextSteps: this.generateNextSteps(scores, recommendations, assessmentType)
                };
                console.log("Generated Report Data:", JSON.parse(JSON.stringify(reportData)));
                return reportData;
            }
            
            generateExecutiveSummary(scores, recommendations, metadata, assessmentType) {
                const orgSize = assessmentType === 'agency' ? metadata.agencySize : metadata.team_size;
                const orgType = assessmentType === 'agency' ? metadata.agencyType : metadata.company_industry;
                const readinessScore = assessmentType === 'agency' ? scores.transformation : scores.overall;
                const readinessLevel = assessmentType === 'agency' ? scores.categories.readiness.label : (scores.overall >= 70 ? "Leader" : scores.overall >= 50 ? "Advancing" : "Emerging");
                
                const topOpportunity = recommendations.immediate?.[0] || recommendations.quickWins?.[0];
                const quickWinHours = assessmentType === 'agency' ? 
                    this.calculateAgencyQuickWinHours(recommendations.quickWins) : 
                    (recommendations.expectedOutcomes?.details?.timeSavings?.split(' ')[0] || 0);

                let headline, subheadline, tone;
                if (readinessScore >= 70) { 
                    headline = `You're Ahead of the Curve`; 
                    subheadline = `Your ${assessmentType} is in the top 20% for AI readiness. Here's how to extend your lead.`; 
                    tone = 'leadership'; 
                }
                else if (readinessScore >= 40) { 
                    headline = `You're Closer Than You Think`; 
                    subheadline = `With focused effort, your ${assessmentType} can leap ahead of competitors.`; 
                    tone = 'opportunity'; 
                }
                else { 
                    headline = `Your Transformation Starts Now`; 
                    subheadline = `Move quickly to gain competitive advantage.`; 
                    tone = 'urgency'; 
                }

                return {
                    headline, 
                    subheadline, 
                    tone,
                    keyMetrics: {
                        readinessScore: { 
                            value: Math.round(readinessScore), 
                            label: 'AI Readiness Score', 
                            interpretation: this.getScoreInterpretation(readinessScore) 
                        },
                        timeToSave: { 
                            value: quickWinHours, 
                            label: 'Hours/Week You Could Save', 
                            interpretation: 'With quick wins alone' 
                        },
                        impactPotential: { 
                            value: assessmentType === 'agency' ? scores.categories.valuation.multiple : (recommendations.expectedOutcomes?.roi || "Significant"), 
                            label: assessmentType === 'agency' ? 'Current Valuation Range' : 'Potential ROI', 
                            interpretation: assessmentType === 'agency' ? 'Could increase by 2-3x' : 'Achievable in 6 months' 
                        }
                    },
                    snapshot: { 
                        strengths: this.identifyStrengths(scores, assessmentType), 
                        gaps: this.identifyGaps(scores, assessmentType), 
                        quickestWin: topOpportunity ? { 
                            action: topOpportunity.title, 
                            impact: topOpportunity.impact || topOpportunity.expectedResult, 
                            effort: topOpportunity.effort || topOpportunity.investment 
                        } : null 
                    },
                    narrative: this.generateNarrative(scores, metadata, tone, assessmentType)
                };
            }
            
            generateReadinessSection(scores, assessmentType) {
                const dimensions = assessmentType === 'agency' ?
                    Object.entries(scores.dimensions).map(([key, score]) => ({ 
                        name: AgencyQuestionsConfig.scoring.dimensions[key]?.displayName || key, 
                        score: Math.round(score), 
                        description: this.getDimensionDescription(key, score, assessmentType) 
                    }))
                    : Object.entries(scores.dimensions).map(([key, score]) => ({ 
                        name: {humanReadiness: "Team & Culture Readiness", technicalReadiness: "Process & Tech Readiness", activityAutomation: "Activity Automation Level"}[key] || key, 
                        score: Math.round(score), 
                        description: this.getDimensionDescription(key, score, assessmentType) 
                    }));
                
                const serviceOrActivityReadiness = assessmentType === 'agency' ?
                    Object.entries(scores.serviceScores || {}).map(([service, score]) => ({ 
                        name: AgencyQuestionsConfig.serviceQuestions[service]?.serviceName || service, 
                        score: score.score, 
                        vulnerability: score.vulnerability, 
                        interpretation: `AI Vulnerability: ${score.vulnerability}%. Readiness: ${score.readiness}`
                    }))
                    : Object.entries(scores.activityScores || {}).map(([activity, scoreData]) => ({ 
                        name: InHouseMarketingAssessment.activityQuestions[activity]?.[0]?.category || activity.replace(/_/g, ' '), 
                        score: scoreData.score, 
                        interpretation: `Current automation level: ${scoreData.score}%` 
                    }));

                return {
                    overall: { 
                        score: Math.round(assessmentType === 'agency' ? scores.transformation : scores.overall), 
                        categoryLabel: assessmentType === 'agency' ? scores.categories.readiness.label : (scores.overall >= 70 ? "Leader" : "Advancing") 
                    },
                    dimensions,
                    serviceOrActivityReadiness,
                    champions: assessmentType === 'agency' ? 
                        this.identifyChampions(scores) : 
                        (scores.dimensions?.humanReadiness > 60 ? "Strong potential for internal champions" : "Needs focus on identifying champions"),
                    barriers: assessmentType === 'agency' ? 
                        this.identifyBarriers(scores) : 
                        (scores.dimensions?.resources < 40 ? "Resource constraints may be a barrier" : "Key barriers seem manageable")
                };
            }
            
            generateOpportunitiesSection(scores, recommendations, assessmentType) {
                return {
                    immediate: { 
                        title: "This Week's Quick Wins", 
                        subtitle: "Start here for immediate impact", 
                        items: (recommendations.quickWins || []).map(win => ({ 
                            ...win, 
                            roi: assessmentType === 'agency' ? this.calculateAgencyQuickWinROI(win) : win.expectedResult 
                        })) 
                    },
                    shortTerm: { 
                        title: "30-90 Day Opportunities", 
                        subtitle: "Building momentum", 
                        items: recommendations.shortTerm || recommendations.implementationPath?.month2?.actions || [] 
                    },
                    transformational: { 
                        title: "Game-Changing Moves", 
                        subtitle: assessmentType === 'agency' ? "For agencies ready to lead" : "For marketing teams aiming for excellence", 
                        items: recommendations.strategic || [recommendations.expectedOutcomes?.headline] || [] 
                    }
                };
            }
            
            generateRoadmapSection(recommendations, assessmentType) {
                const roadmap = recommendations.transformationRoadmap || recommendations.strategicRoadmap;
                if (!roadmap) return { 
                    overview: { title: "Transformation Journey", approach: "Phased implementation recommended." }, 
                    phases: []
                };
                
                return {
                    overview: { 
                        title: `Your ${assessmentType === 'agency' ? '6-Month' : (roadmap.overview || 'Transformation')} Journey`, 
                        totalDuration: roadmap.phase3?.duration || "90+ Days", 
                        approach: "Iterative sprints focusing on value." 
                    },
                    phases: Object.values(roadmap).filter(p => typeof p === 'object' && p.name).map(phase => ({ 
                        title: phase.name || phase.title, 
                        duration: phase.duration || "30 Days", 
                        focus: phase.focus, 
                        actions: phase.actions || phase.milestones || [], 
                        outcome: phase.expectedOutcome || "" 
                    }))
                };
            }
            
            generateImpactSection(scores, metadata, assessmentType) {
                if (assessmentType === 'agency') {
                    const currentMultiple = this.estimateCurrentMultiple(scores); 
                    const potentialMultiple = this.estimatePotentialMultiple(scores); 
                    const valuationLift = ((potentialMultiple / currentMultiple - 1) * 100).toFixed(0);
                    
                    return {
                        title: "The Hidden Value in Your Transformation", 
                        subtitle: "How AI readiness translates to agency value",
                        current: { 
                            multiple: `${currentMultiple.toFixed(1)}x EBITDA`, 
                            category: scores.categories.valuation.label 
                        },
                        potential: { 
                            multiple: `${potentialMultiple.toFixed(1)}x EBITDA`, 
                            increase: `+${valuationLift}%`, 
                            achievableIn: "12-18 months" 
                        },
                        drivers: [ 
                            { driver: "Recurring Revenue", potentialImpact: "+0.5-1.0x", action: "Convert project clients to retainers" }, 
                            { driver: "AI Capabilities", potentialImpact: "+1.0-2.0x", action: "Demonstrate AI-enhanced services" } 
                        ],
                        risks: scores.riskFactors?.map(risk => ({ 
                            ...risk, 
                            mitigation: "Strategic AI adoption mitigates these risks." 
                        })) || []
                    };
                } else {
                    const outcomes = recommendations.expectedOutcomes || {};
                    return {
                        title: "Expected Business Impact", 
                        subtitle: "How AI transformation drives marketing results",
                        headline: outcomes.headline || "Significant productivity and output gains expected.",
                        details: outcomes.details || { 
                            timeSavings: "Substantial time savings", 
                            outputIncrease: "Increased content and campaign velocity" 
                        },
                        timeline: outcomes.timeline || { 
                            month1: "Initial gains", 
                            month3: "Major improvements" 
                        },
                        roi: outcomes.roi || "High ROI expected within 6-12 months."
                    };
                }
            }
            
            generateNextSteps(scores, recommendations, assessmentType) {
                const urgency = this.determineUrgency(scores, assessmentType);
                const primaryCTA = this.getPrimaryCTA(scores, assessmentType);
                const ctaOptions = [
                    { 
                        title: "QuickMap.ai Consultation", 
                        description: `Get your personalized 90-day AI transformation roadmap for your ${assessmentType}.`, 
                        price: "£500", 
                        idealFor: "Teams ready to move fast or build strong foundations." 
                    },
                    { 
                        title: "Transformation Program", 
                        description: `Full support to implement your ${assessmentType}'s AI transformation.`, 
                        price: "From £5,000", 
                        idealFor: `For ${assessmentType}s serious about leading their market.` 
                    },
                    { 
                        title: "Free Resources", 
                        description: "Start your journey today with guides and templates.", 
                        price: "Free", 
                        idealFor: "Exploring possibilities and self-starters." 
                    }
                ];
                
                return {
                    urgency, 
                    primaryCTA, 
                    options: ctaOptions,
                    testimonial: this.getRelevantTestimonial(scores, metadata, assessmentType),
                    booking: { 
                        headline: primaryCTA.headline, 
                        subheadline: primaryCTA.subheadline, 
                        buttonText: primaryCTA.buttonText, 
                        urgencyMessage: urgency.message 
                    }
                };
            }

            identifyChampions(scores) {
                if (!scores || !scores.dimensions) return "Champion status unclear due to incomplete data.";
                if (scores.dimensions.transformation > 70) return "Strong internal champions identified, ready to lead AI initiatives.";
                if (scores.dimensions.transformation > 50) return "Potential for AI champions exists; needs nurturing and empowerment.";
                return "Needs focus on identifying and empowering AI champions to drive transformation.";
            }

            identifyBarriers(scores) {
                if (!scores || !scores.dimensions) return "Potential barriers unclear due to incomplete data.";
                const barriers = [];
                if (scores.dimensions.resources < 40) barriers.push("resource constraints");
                if (scores.dimensions.change < 40) barriers.push("resistance to change");
                if (scores.dimensions.leadership < 50) barriers.push("leadership alignment/buy-in");
                
                if (barriers.length === 0) return "Key barriers appear manageable with proactive strategies.";
                return `Key barriers include: ${barriers.join(', ')}. Addressing these is crucial.`;
            }

            calculateAgencyQuickWinHours(quickWins) { 
                if(!quickWins) return 0; 
                return quickWins.reduce((total, win) => { 
                    const match = win.time?.match(/(\d+)\s*(hours?|mins?)/i); 
                    if (match) { 
                        const value = parseInt(match[1]); 
                        const unit = match[2].toLowerCase(); 
                        if (unit.includes('hour')) return total + value; 
                        if (unit.includes('min')) return total + (value / 60); 
                    } 
                    return total; 
                }, 0).toFixed(1); 
            }
            
            calculateAgencyQuickWinROI(win) {
                return win.impact || "Immediate efficiency gain";
            }
            
            getScoreInterpretation(score) { 
                if (score >= 80) return "Exceptional"; 
                if (score >= 70) return "Strong"; 
                if (score >= 60) return "Good"; 
                if (score >= 40) return "Developing"; 
                return "Early stage"; 
            }
            
            identifyStrengths(scores, assessmentType) { 
                const strengths = []; 
                const mainScore = assessmentType === 'agency' ? scores.dimensions.transformation : scores.overall; 
                if (mainScore > 70) strengths.push(assessmentType === 'agency' ? "Strong AI foundation" : "High overall readiness"); 
                if (assessmentType === 'agency' && scores.dimensions.leadership > 70) strengths.push("Leadership alignment for AI"); 
                else if (assessmentType === 'inhouse' && scores.dimensions.humanReadiness > 70) strengths.push("Excellent team and culture readiness"); 
                return strengths.slice(0, 2); 
            }
            
            identifyGaps(scores, assessmentType) { 
                const gaps = []; 
                const mainScore = assessmentType === 'agency' ? scores.dimensions.transformation : scores.overall; 
                if (mainScore < 40) gaps.push(assessmentType === 'agency' ? "Limited AI adoption" : "Overall readiness needs improvement"); 
                if (assessmentType === 'agency' && scores.dimensions.resources < 40) gaps.push("Resource constraints for AI"); 
                else if (assessmentType === 'inhouse' && scores.dimensions.technicalReadiness < 40) gaps.push("Technical/process gaps for AI"); 
                return gaps.slice(0, 2); 
            }
            
            generateNarrative(scores, metadata, tone, assessmentType) { 
                const mainScore = assessmentType === 'agency' ? scores.transformation : scores.overall; 
                let narrative = `Your ${assessmentType} shows ${tone === 'leadership' ? 'excellent' : tone === 'opportunity' ? 'strong potential for' : 'a clear starting point for'} AI transformation. With a readiness score of ${Math.round(mainScore)}%, `; 
                
                if (tone === 'leadership') narrative += `you're poised to extend your lead. Focusing on strategic AI integration can further solidify your market position and unlock premium ${assessmentType === 'agency' ? 'valuation' : 'results'}.`; 
                else if (tone === 'opportunity') narrative += `you're well-positioned to leap ahead. Key is moving quickly on targeted AI initiatives to build momentum and demonstrate ROI.`; 
                else narrative += `the path to significant improvement is clear. Starting with high-impact quick wins will build confidence and free up resources for broader transformation.`; 
                
                return narrative; 
            }
            
            getDimensionDescription(dimension, score, assessmentType) { 
                const descMap = { 
                    transformation: {high: "Team actively embracing AI", medium: "Some AI experimentation", low: "Limited AI adoption"}, 
                    resources: {high: "Strong resources for AI", medium: "Manageable constraints", low: "Tight resources"}, 
                    leadership: {high: "Leadership champions AI", medium: "Leadership needs more evidence", low: "Leadership skepticism a barrier"}, 
                    change: {high: "Proven ability to adapt", medium: "Mixed change record", low: "Change is challenging"}, 
                    humanReadiness: {high: "Team is highly adaptable and eager", medium: "Good cultural foundation for AI", low: "Focus on building team buy-in"}, 
                    technicalReadiness: {high: "Processes and tech are AI-ready", medium: "Some tech/process optimization needed", low: "Significant tech/process groundwork required"}, 
                    activityAutomation: {high: "Many activities show AI leverage", medium: "Key activities ripe for AI", low: "Basic automation opportunities exist"} 
                }; 
                const level = score >= 70 ? 'high' : score >= 40 ? 'medium' : 'low'; 
                return descMap[dimension]?.[level] || "Further analysis needed."; 
            }
            
            estimateCurrentMultiple(scores) { 
                let base = 3.5; 
                if (scores.valuationDimensions.financial > 70) base += 1.0; 
                else if (scores.valuationDimensions.financial < 40) base -= 1.0; 
                if (scores.valuationDimensions.operational > 70) base += 0.5; 
                else if (scores.valuationDimensions.operational < 40) base -= 0.5; 
                if (scores.transformation > 70) base += 0.5; 
                if (scores.serviceVulnerability > 70) base -= 0.5; 
                return Math.max(1.5, Math.min(6.0, base)); 
            }
            
            estimatePotentialMultiple(scores) { 
                let potential = this.estimateCurrentMultiple(scores); 
                if (scores.valuationDimensions.financial < 60) potential += 0.75; 
                if (scores.transformation < 60) potential += 1.0; 
                if (scores.serviceVulnerability > 60) potential += 0.75; 
                return Math.min(8.0, potential); 
            }
            
            determineUrgency(scores, assessmentType) { 
                const mainScore = assessmentType === 'agency' ? scores.transformation : scores.overall; 
                if (assessmentType === 'agency' && scores.serviceVulnerability > 75) return { level: 'high', message: 'Core services face immediate AI disruption', color: '#FF4444' }; 
                if (mainScore < 30) return { level: 'high', message: 'Competitors are pulling ahead with AI', color: '#FF8800' }; 
                if (mainScore > 70) return { level: 'opportunity', message: 'Perfect timing to extend your lead', color: '#00AA00' }; 
                return { level: 'moderate', message: 'Good window to gain competitive advantage', color: '#FFAA00' }; 
            }
            
            getPrimaryCTA(scores, assessmentType) { 
                const mainScore = assessmentType === 'agency' ? scores.transformation : scores.overall; 
                if (mainScore >= 70) return { headline: "Ready to Dominate Your Market?", subheadline: "Let's build your AI leadership strategy", buttonText: "Book Strategic Consultation" }; 
                if (mainScore >= 40) return { headline: `Ready to Transform Your ${assessmentType}?`, subheadline: "Get your personalized 90-day roadmap", buttonText: "Get Your QuickMap.ai" }; 
                return { headline: `Ready to Future-Proof Your ${assessmentType}?`, subheadline: "Start with quick wins that prove ROI", buttonText: "Book Free Discovery Call" }; 
            }
            
            getRelevantTestimonial(scores, metadata, assessmentType) { 
                const mainScore = assessmentType === 'agency' ? scores.transformation : scores.overall; 
                const level = mainScore >= 70 ? 'high' : mainScore >= 40 ? 'medium' : 'low'; 
                const testimonials = { 
                    high: { quote: "Obsolete helped us go from AI-curious to AI-leaders. We're winning pitches we couldn't compete for before.", author: "Sarah C., CEO, Digital Agency" }, 
                    medium: { quote: "The QuickMap.ai session was a game-changer. Clear plan we could actually execute.", author: "Mark T., Founder, Creative Agency" }, 
                    low: { quote: "We thought we were too small. Obsolete showed us where to start and held our hand.", author: "Jessica W., MD, PR Agency" } 
                }; 
                return testimonials[level]; 
            }
        }

        // --- Global State & Configuration ---
        window.userData = {
            assessmentType: null, 
            currentScreenId: 'assessment-selection',
            history: [], 
            qualifying: {},
            services: {},
            questions: {},
            currentQuestionSet: [], 
            currentQuestionIndex: 0,
            totalQuestionsInSet: 0,
            emailData: {}
        };

        const screenOrder = [
            'assessment-selection', 
            'sector-selection', 
            'qualifying-questions', 
            'service-selection', 
            'dynamic-questions', 
            'email-gate',
        ];

        // --- Screen Management ---
        window.showScreen = function(screenId) {
            console.log("Showing screen:", screenId);
            if (window.userData.currentScreenId && window.userData.currentScreenId !== screenId && !window.userData.currentScreenId.includes("-results")) {
                window.userData.history.push(window.userData.currentScreenId);
            }
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.add('active');
                window.userData.currentScreenId = screenId;
                window.updateProgressBar();
                saveProgress();
            } else {
                console.error("Screen not found:", screenId);
            }
        };
        
        window.updateProgressBar = function() {
            const currentScreenIndex = screenOrder.indexOf(window.userData.currentScreenId);
            let progressPercent = 0;
            let currentStepNumber = 0;
            const totalSteps = screenOrder.length + 1;

            if (currentScreenIndex !== -1) {
                currentStepNumber = currentScreenIndex + 1;
                progressPercent = (currentStepNumber / totalSteps) * 100;
            } else if (window.userData.currentScreenId.includes('-results')) {
                currentStepNumber = totalSteps;
                progressPercent = 100;
            }
            
            const progressBarFill = document.getElementById(`progress-fill-bar-${window.userData.currentScreenId}`);
            const progressStepText = document.getElementById(`progress-step-text-${window.userData.currentScreenId}`);

            if (progressBarFill) progressBarFill.style.width = `${progressPercent}%`;
            
            if (progressStepText) {
                if (window.userData.currentScreenId.includes('-results')) {
                    progressStepText.textContent = `Results Ready!`;
                } else if (currentStepNumber > 0) {
                    progressStepText.textContent = `Step ${currentStepNumber} of ${totalSteps}`;
                }
            }
        };

        window.previousScreen = function() {
            if (window.userData.history.length > 0) {
                const previousScreenId = window.userData.history.pop();
                window.showScreen(previousScreenId);
            } else {
                window.showScreen('assessment-selection'); 
            }
        };

        window.nextScreen = function() {
            const currentScreenIndex = screenOrder.indexOf(window.userData.currentScreenId);
            if (currentScreenIndex !== -1 && currentScreenIndex < screenOrder.length - 1) {
                const nextScreenId = screenOrder[currentScreenIndex + 1];
                
                if (window.userData.currentScreenId === 'qualifying-questions' && window.userData.assessmentType === 'inhouse') {
                    console.log("In-house skipping service selection, loading dynamic questions.");
                    window.loadAssessmentQuestions(); 
                    window.showScreen('dynamic-questions');
                } else if (nextScreenId === 'dynamic-questions') {
                    console.log("Loading dynamic questions.");
                    window.loadAssessmentQuestions(); 
                    window.showScreen(nextScreenId);
                } else if (nextScreenId === 'qualifying-questions') {
                    loadQualifyingQuestions();
                    window.showScreen(nextScreenId);
                } else if (nextScreenId === 'service-selection') {
                    loadServiceSelection();
                    window.showScreen(nextScreenId);
                }
                else {
                     window.showScreen(nextScreenId);
                }
            } else {
                console.log("End of flow or current screen not in order. Current:", window.userData.currentScreenId);
            }
        };
        
        window.startNewAssessment = function() {
            window.userData = {
                assessmentType: null, 
                currentScreenId: 'assessment-selection',
                history: [], 
                qualifying: {},
                services: {},
                questions: {},
                currentQuestionSet: [], 
                currentQuestionIndex: 0,
                totalQuestionsInSet: 0,
                emailData: {}
            };
            window.showScreen('assessment-selection');
            clearProgress();
        };

        // --- Progress Management ---
        function saveProgress() {
            try {
                const progressData = {
                    userData: window.userData,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('assessmentProgress', JSON.stringify(progressData));
                showSaveIndicator();
            } catch (e) {
                console.error('Failed to save progress:', e);
            }
        }

        function loadProgress() {
            try {
                const saved = localStorage.getItem('assessmentProgress');
                if (saved) {
                    const progressData = JSON.parse(saved);
                    const hoursSinceLastSave = (new Date() - new Date(progressData.timestamp)) / (1000 * 60 * 60);
                    
                    if (hoursSinceLastSave < 24) {
                        window.userData = progressData.userData;
                        console.log('Progress restored from', progressData.timestamp);
                        return true;
                    }
                }
            } catch (e) {
                console.error('Failed to load progress:', e);
            }
            return false;
        }

        window.clearProgress = function() {
            localStorage.removeItem('assessmentProgress');
            console.log('Progress cleared');
        };

        function showSaveIndicator() {
            const indicator = document.getElementById('save-indicator');
            if (indicator) {
                indicator.classList.add('visible');
                setTimeout(() => indicator.classList.remove('visible'), 2000);
            }
        }

        // --- Assessment Logic ---
        window.selectAssessment = function(type) {
            window.userData.assessmentType = type;
            console.log("Assessment type selected:", type);
            window.userData.qualifying = {}; 
            window.userData.services = {}; 
            window.userData.questions = {}; 
            window.userData.currentQuestionIndex = 0; 
            window.userData.history = ['assessment-selection']; 
            loadSectorOptions(type);
            window.showScreen('sector-selection');
        };

        function loadSectorOptions(assessmentType) {
            const container = document.getElementById('sector-options-container');
            const titleEl = document.getElementById('sector-title');
            const descriptionEl = document.getElementById('sector-description');
            let options = [];

            if (assessmentType === 'agency') {
                titleEl.textContent = "What type of agency are you?";
                descriptionEl.textContent = "We'll tailor your assessment to the unique challenges of your sector.";
                options = AgencyQuestionsConfig.qualifying.find(q => q.id === 'agency_type').options;
            } else if (assessmentType === 'inhouse') {
                titleEl.textContent = "What industry is your company in?";
                descriptionEl.textContent = "Understanding your industry helps us provide relevant AI insights.";
                options = InHouseMarketingAssessment.qualifying.find(q => q.id === 'company_industry').options;
            }
            
            container.innerHTML = options.map(opt => `
                <div class="option" onclick="window.selectSectorOption(this, '${opt.value}')">
                    <div class="option-icon">${opt.icon || '🏢'}</div>
                    <div class="option-content">
                        <div class="option-title">${opt.label}</div>
                        ${opt.description ? `<div class="option-description">${opt.description}</div>` : ''}
                    </div>
                </div>
            `).join('');
            document.getElementById('sector-continue').disabled = true;
        }

        window.selectSectorOption = function(element, value) {
            document.querySelectorAll('#sector-options-container .option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            window.userData.qualifying.sector = value;
            document.getElementById('sector-continue').disabled = false;
            console.log("Sector selected:", value);
            saveProgress();
        };
        
        function loadQualifyingQuestions() {
            const container = document.getElementById('qualifying-questions-container');
            const orgTypeSpan = document.getElementById('qualifying-org-type');
            orgTypeSpan.textContent = window.userData.assessmentType === 'agency' ? 'agency' : 'company';

            const questions = window.userData.assessmentType === 'agency' ? 
                AgencyQuestionsConfig.qualifying.filter(q => q.id !== 'agency_type') :
                InHouseMarketingAssessment.qualifying.filter(q => q.id !== 'company_industry');

            container.innerHTML = questions.map(q => {
                const defaultValueIndex = Math.floor(q.options.length / 2);
                const defaultValue = q.options[defaultValueIndex].value;
                window.userData.qualifying[q.id] = defaultValue;

                return `
                <div class="qualifying-question-card">
                    <h3 class="qualifying-question-title">${q.question}</h3>
                    <div class="options">
                        ${q.options.map(opt => `
                            <div class="option ${opt.value === defaultValue ? 'selected' : ''}" onclick="window.selectQualifyingOption(this, '${q.id}', '${opt.value}')">
                                <div class="option-check">${opt.value === defaultValue ? '✓' : ''}</div>
                                <div class="option-content">
                                    <div class="option-text">${opt.label}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `}).join('');
            document.getElementById('qualifying-continue').disabled = false;
        }
        
        window.selectQualifyingOption = function(element, questionId, value) {
            element.closest('.options').querySelectorAll('.option').forEach(el => {
                el.classList.remove('selected');
                el.querySelector('.option-check').textContent = '';
            });
            element.classList.add('selected');
            element.querySelector('.option-check').textContent = '✓';
            window.userData.qualifying[questionId] = value;
            console.log("Qualifying answer:", questionId, value);
            saveProgress();
        };

        function loadServiceSelection() {
            const container = document.getElementById('services-grid-container');
            const titleEl = document.getElementById('service-selection-title');
            const descriptionEl = document.getElementById('service-selection-description');
            let servicesOrActivities = [];

            if (window.userData.assessmentType === 'agency') {
                titleEl.textContent = "What services contribute most to your revenue?";
                descriptionEl.textContent = "Drag the sliders to show relative importance. This helps us focus on your key areas.";
                servicesOrActivities = Object.entries(AgencyQuestionsConfig.serviceQuestions).map(([id, data]) => ({
                    id,
                    name: data.serviceName,
                    description: `AI Vulnerability: ${data.aiVulnerability}%`,
                    icon: {content_creation: "✍️", creative_design: "🎨", digital_marketing: "💻", seo_sem: "🔍", pr_comms: "📢", strategy_consulting: "🧭"}[id] || "💼"
                }));
                container.innerHTML = servicesOrActivities.map(s => `
                    <div class="service-item">
                        <div class="service-row">
                            <div class="service-icon">${s.icon}</div>
                            <div class="service-content">
                                <div class="service-name">${s.name}</div>
                                <div class="service-description">${s.description}</div>
                            </div>
                        </div>
                        <div class="slider-container">
                            <input type="range" min="0" max="100" value="0" data-service-id="${s.id}"
                                   oninput="window.updateServiceSlider(this)">
                            <span class="slider-value" id="service-value-${s.id}">0%</span>
                        </div>
                    </div>
                `).join('');
            } else {
                titleEl.textContent = "Which marketing activities does your team handle?";
                descriptionEl.textContent = "Select all that apply. This helps us tailor AI recommendations.";
                servicesOrActivities = Object.entries(InHouseMarketingAssessment.activityQuestions).map(([id, data]) => ({
                    id,
                    name: data[0]?.category || id.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
                    icon: {content_marketing: "✍️", social_media: "📱", email_marketing: "📧", seo_sem: "🔍", analytics_data: "📊", paid_advertising:"💳", creative_design:"🎨", marketing_automation:"⚙️"}[id] || "🚀"
                }));
                container.innerHTML = servicesOrActivities.map(s => `
                    <div class="option service-option" onclick="window.toggleServiceSelection(this, '${s.id}')">
                        <div class="option-check"></div>
                        <div class="option-icon">${s.icon}</div>
                        <div class="option-content">
                            <div class="option-title">${s.name}</div>
                        </div>
                    </div>
                `).join('');
            }
            document.getElementById('service-continue').disabled = true;
        }

        window.updateServiceSlider = function(slider) {
            const displayId = `service-value-${slider.dataset.serviceId}`;
            document.getElementById(displayId).textContent = slider.value + '%';
            window.userData.services[slider.dataset.serviceId] = parseInt(slider.value);
            console.log("Agency Service importance:", slider.dataset.serviceId, slider.value);
            const anyValue = Object.values(window.userData.services).some(val => val > 0);
            document.getElementById('service-continue').disabled = !anyValue;
            saveProgress();
        };

        window.toggleServiceSelection = function(element, activityId) {
            element.classList.toggle('selected');
            const isSelected = element.classList.contains('selected');
            element.querySelector('.option-check').textContent = isSelected ? '✓' : '';
            window.userData.services[activityId] = isSelected;
            console.log("InHouse Activity selected:", activityId, isSelected);
            const anySelected = Object.values(window.userData.services).some(val => val === true);
            document.getElementById('service-continue').disabled = !anySelected;
            saveProgress();
        };

        // --- Dynamic Question Handling ---
        window.loadAssessmentQuestions = function() {
            console.log("Loading assessment questions for:", window.userData.assessmentType);
            let allCoreQuestions = [];
            let allActivityOrServiceQuestions = [];

            if (window.userData.assessmentType === 'agency') {
                Object.values(AgencyQuestionsConfig.coreQuestions).forEach(category => {
                    allCoreQuestions.push(...category);
                });
                Object.entries(window.userData.services).forEach(([serviceId, importance]) => {
                    if (importance > 0 && AgencyQuestionsConfig.serviceQuestions[serviceId]) {
                        allActivityOrServiceQuestions.push(...AgencyQuestionsConfig.serviceQuestions[serviceId].questions.map(q => ({...q, serviceContext: AgencyQuestionsConfig.serviceQuestions[serviceId].serviceName})));
                    }
                });
            } else {
                allCoreQuestions = InHouseMarketingAssessment.coreQuestions;
                Object.entries(window.userData.services).forEach(([activityId, isSelected]) => {
                    if (isSelected && InHouseMarketingAssessment.activityQuestions[activityId]) {
                        allActivityOrServiceQuestions.push(...InHouseMarketingAssessment.activityQuestions[activityId].map(q => ({...q, activityContext: activityId.replace(/_/g, ' ')})));
                    }
                });
            }
            
            window.userData.currentQuestionSet = [...allCoreQuestions, ...allActivityOrServiceQuestions];
            window.userData.totalQuestionsInSet = window.userData.currentQuestionSet.length;
            window.userData.currentQuestionIndex = 0;
            if(window.userData.totalQuestionsInSet > 0) {
                window.showQuestion(window.userData.currentQuestionIndex);
            } else {
                console.log("No questions to show, proceeding to email gate.");
                window.showScreen('email-gate');
            }
        };

        window.showQuestion = function(index) {
            if (index < 0 || index >= window.userData.currentQuestionSet.length) {
                if (index >= window.userData.currentQuestionSet.length && window.userData.currentQuestionSet.length > 0) {
                    window.showScreen('email-gate');
                }
                return;
            }
            const questionData = window.userData.currentQuestionSet[index];
            document.getElementById('dynamic-question-number').textContent = `Question ${index + 1} of ${window.userData.totalQuestionsInSet}`;
            document.getElementById('dynamic-question-text').textContent = questionData.question || questionData.text;
            
            const optionsContainer = document.getElementById('dynamic-question-options-container');
            optionsContainer.innerHTML = questionData.options.map(opt => `
                <div class="option" onclick="window.selectQuestionOption(this, '${questionData.id}', ${opt.score !== undefined ? opt.score : opt.value})">
                    <div class="option-check"></div>
                    <div class="option-content">
                        <div class="option-text">${opt.text || opt.label}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('dynamic-question-insight').textContent = questionData.insight || '';
            document.getElementById('dynamic-question-benchmark').textContent = questionData.benchmark || '';
            document.getElementById('dynamic-question-continue').disabled = true; 
            
            const dynamicProgressFill = document.getElementById('progress-fill-bar-dynamic-questions');
            const dynamicProgressText = document.getElementById('progress-step-text-dynamic-questions');
            if(dynamicProgressFill && dynamicProgressText) {
                const baseScreenIndex = screenOrder.indexOf('dynamic-questions');
                const baseProgress = ((baseScreenIndex +1) / (screenOrder.length + 1)) * 100;
                const questionProgressWithinStep = ((index + 1) / window.userData.totalQuestionsInSet) * (100 / (screenOrder.length + 1));
                dynamicProgressFill.style.width = `${baseProgress + questionProgressWithinStep}%`;
                dynamicProgressText.textContent = `Step ${baseScreenIndex + 1} of ${screenOrder.length + 1} (Q ${index + 1}/${window.userData.totalQuestionsInSet})`;
            }
        };

        window.selectQuestionOption = function(element, questionId, score) {
            document.querySelectorAll('#dynamic-question-options-container .option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            element.querySelector('.option-check').textContent = '✓';
            window.userData.questions[questionId] = score;
            document.getElementById('dynamic-question-continue').disabled = false;
            console.log("Question answered:", questionId, score);
            saveProgress();
            setTimeout(window.nextQuestion, 300);
        };

        window.previousQuestion = function() {
            if (window.userData.currentQuestionIndex > 0) {
                window.userData.currentQuestionIndex--;
                window.showQuestion(window.userData.currentQuestionIndex);
            } else {
                window.previousScreen();
            }
        };

        window.nextQuestion = function() {
            const currentQuestionId = window.userData.currentQuestionSet[window.userData.currentQuestionIndex]?.id;
            if (!currentQuestionId || window.userData.questions[currentQuestionId] === undefined) {
                // Question skipped
            }

            if (window.userData.currentQuestionIndex < window.userData.currentQuestionSet.length - 1) {
                window.userData.currentQuestionIndex++;
                window.showQuestion(window.userData.currentQuestionIndex);
            } else {
                console.log("All questions answered or skipped.");
                window.showScreen('email-gate');
            }
        };
        
        window.skipQuestion = function() {
            const currentQuestionId = window.userData.currentQuestionSet[window.userData.currentQuestionIndex]?.id;
            if (currentQuestionId) {
                window.userData.questions[currentQuestionId] = null;
                console.log("Skipped question:", currentQuestionId);
            }
            window.nextQuestion();
        };

        // --- Email & Results ---
        window.submitEmail = async function(event) {
            event.preventDefault();
            const loadingOverlay = document.getElementById('loading-overlay');
            const loadingText = document.getElementById('loading-overlay-text');
            loadingText.textContent = "Calculating your results...";
            loadingOverlay.classList.add('visible');

            const form = event.target;
            window.userData.emailData.email = form.email.value;
            window.userData.emailData.firstName = form.firstName.value;
            window.userData.emailData.lastName = form.lastName.value;
            window.userData.emailData.company = form.company.value;
            window.userData.emailData.phone = form.phone.value;
            window.userData.emailData.marketingConsent = form.marketingConsent.checked;
            
            console.log("Email form submitted:", window.userData.emailData);
            await new Promise(resolve => setTimeout(resolve, 1500)); 
            
            loadingText.textContent = "Generating your report...";
            await new Promise(resolve => setTimeout(resolve, 1000)); 

            window.displayResults();
            loadingOverlay.classList.remove('visible');
        };

        // --- Scoring Logic for In-House ---
        function calculateInHouseScores(answers, qualifyingData, activitySelections) {
            const scores = {
                overall: 0,
                dimensions: { humanReadiness: 0, technicalReadiness: 0, activityAutomation: 0 },
                activityScores: {}
            };
            const { coreQuestions, activityQuestions, scoringDimensions, marketBenchmarks, sizeModifiers } = InHouseMarketingAssessment;
            
            const categoryScores = { champions: [], leadership: [], resources: [], readiness: [] };
            coreQuestions.forEach(q => {
                if (answers[q.id] !== undefined && answers[q.id] !== null && categoryScores[q.category]) {
                    categoryScores[q.category].push({ score: answers[q.id], weight: q.weight || 1 });
                }
            });

            const calculateWeightedAverage = (catScores) => {
                if (!catScores || catScores.length === 0) return 50;
                let totalScore = 0;
                let totalWeight = 0;
                catScores.forEach(s => { totalScore += s.score * s.weight; totalWeight += s.weight; });
                return totalWeight > 0 ? (totalScore / totalWeight / 5 * 100) : 50;
            };

            const humanCategories = ['champions', 'leadership', 'resources'];
            humanCategories.forEach(cat => {
                scores.dimensions.humanReadiness += calculateWeightedAverage(categoryScores[cat]);
            });
            scores.dimensions.humanReadiness /= humanCategories.length;

            scores.dimensions.technicalReadiness = calculateWeightedAverage(categoryScores['readiness']);

            let totalActivityScore = 0;
            let numSelectedActivities = 0;
            Object.keys(activitySelections).filter(actId => activitySelections[actId]).forEach(actId => {
                const actQs = activityQuestions[actId];
                if (actQs) {
                    const actCatScores = [];
                    actQs.forEach(q => {
                        if (answers[q.id] !== undefined && answers[q.id] !== null) {
                             actCatScores.push({ score: answers[q.id], weight: q.weight || 1 });
                        }
                    });
                    const activityScore = calculateWeightedAverage(actCatScores);
                    scores.activityScores[actId] = { score: Math.round(activityScore) };
                    totalActivityScore += activityScore;
                    numSelectedActivities++;
                }
            });
            scores.dimensions.activityAutomation = numSelectedActivities > 0 ? totalActivityScore / numSelectedActivities : 50;

            scores.overall = (scores.dimensions.humanReadiness * scoringDimensions.humanReadiness.weight) +
                             (scores.dimensions.technicalReadiness * scoringDimensions.technicalReadiness.weight) +
                             (scores.dimensions.activityAutomation * scoringDimensions.activityAutomation.weight);
            
            const companySizeKey = qualifyingData.team_size || 'small';
            const modifierKey = Object.keys(sizeModifiers).find(key => companySizeKey.includes(key)) || 'small';
            scores.sizeModifierApplied = modifierKey;

            scores.overall = Math.round(scores.overall);
            Object.keys(scores.dimensions).forEach(dim => scores.dimensions[dim] = Math.round(scores.dimensions[dim]));
            
            console.log("Calculated In-House Scores:", JSON.parse(JSON.stringify(scores)));
            return scores;
        }

        window.displayResults = function() {
            let scores, recommendations, reportData;
            const reportGenerator = new TransformationReport();

            const metadata = {
                agencySize: window.userData.qualifying.agency_size,
                revenue: window.userData.qualifying.annual_revenue,
                agencyType: window.userData.qualifying.sector,
                selectedServices: Object.keys(window.userData.services).filter(s => window.userData.services[s] > 0),
                team_size: window.userData.qualifying.team_size,
                company_industry: window.userData.qualifying.sector,
                company_revenue_inhouse: window.userData.qualifying.company_revenue_inhouse,
                selectedActivities: Object.keys(window.userData.services).filter(act => window.userData.services[act]),
                userEmail: window.userData.emailData.email,
                userName: `${window.userData.emailData.firstName || ''} ${window.userData.emailData.lastName || ''}`.trim(),
                companyName: window.userData.emailData.company
            };
            
            if (window.userData.assessmentType === 'agency') {
                const agencyScorer = new AgencyTransformationScoring(AgencyQuestionsConfig.scoring);
                scores = agencyScorer.calculateScores(window.userData.questions, metadata);
                
                const agencyRecommender = new AgencyRecommendationsEngine();
                const assessmentDataForRecs = { scores, answers: window.userData.questions, ...metadata };
                recommendations = agencyRecommender.generateRecommendations(assessmentDataForRecs);
                
                reportData = reportGenerator.generateReport(scores, recommendations, metadata, 'agency');

            } else {
                scores = calculateInHouseScores(window.userData.questions, window.userData.qualifying, window.userData.services);
                
                const inhouseRecommender = new InhouseRecommendationsEngineV3({scores, responses: {...window.userData.qualifying, ...window.userData.questions, selectedActivities: metadata.selectedActivities}});
                recommendations = inhouseRecommender.generateRecommendations(scores, {...window.userData.qualifying, ...window.userData.questions, selectedActivities: metadata.selectedActivities, companySize: metadata.team_size});
                
                reportData = reportGenerator.generateReport(scores, recommendations, metadata, 'inhouse');
            }
            
            const resultsScreenId = `${window.userData.assessmentType}-results`;
            const dashboardContainerId = `${window.userData.assessmentType}-results-dashboard-container`;
            const dashboardContainer = document.getElementById(dashboardContainerId);
            dashboardContainer.innerHTML = '';

            window.showScreen(resultsScreenId);
            updateProgressBar();

            renderFullReport(dashboardContainer, reportData, window.userData.assessmentType);
        };

        function renderFullReport(container, reportData, assessmentType) {
            const createElement = (tag, className, textContent) => {
                const el = document.createElement(tag);
                if (className) el.className = className;
                if (textContent) el.textContent = textContent;
                return el;
            };
            const createPara = (text, className) => createElement('p', className, text);
            const createHeader = (level, text, className) => createElement(`h${level}`, className, text);

            // 1. Executive Summary
            const execSection = createElement('div', 'report-section executive-summary');
            const execHeader = createElement('div', 'results-header');
            
            const scoreCircle = createElement('div', 'score-circle');
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "180"); 
            svg.setAttribute("height", "180");
            
            const circleBg = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circleBg.setAttribute("cx", "90");
            circleBg.setAttribute("cy", "90");
            circleBg.setAttribute("r", "80");
            circleBg.setAttribute("stroke", "rgba(255,255,255,0.1)");
            circleBg.setAttribute("stroke-width", "10");
            circleBg.setAttribute("fill", "none");
            
            const circleFg = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            const circumference = 2 * Math.PI * 80;
            const offset = circumference - (reportData.executive.keyMetrics.readinessScore.value / 100) * circumference;
            circleFg.setAttribute("cx", "90");
            circleFg.setAttribute("cy", "90");
            circleFg.setAttribute("r", "80");
            circleFg.setAttribute("stroke", "#ffff66");
            circleFg.setAttribute("stroke-width", "10");
            circleFg.setAttribute("fill", "none");
            circleFg.setAttribute("stroke-dasharray", circumference);
            circleFg.setAttribute("stroke-dashoffset", offset);
            circleFg.setAttribute("style", "transition: stroke-dashoffset 1s ease;");
            
            svg.appendChild(circleBg); 
            svg.appendChild(circleFg); 
            scoreCircle.appendChild(svg);
            scoreCircle.appendChild(createElement('div', 'score-value', reportData.executive.keyMetrics.readinessScore.value));
            scoreCircle.appendChild(createElement('div', 'score-label', reportData.executive.keyMetrics.readinessScore.label));
            execHeader.appendChild(scoreCircle);

            const headlineSection = createElement('div', 'headline-section');
            headlineSection.appendChild(createHeader(1, reportData.executive.headline));
            headlineSection.appendChild(createPara(reportData.executive.subheadline, 'subheadline'));
            execHeader.appendChild(headlineSection);
            execSection.appendChild(execHeader);

            const metricsGrid = createElement('div', 'key-metrics-grid');
            Object.values(reportData.executive.keyMetrics).forEach(metric => {
                const card = createElement('div', 'metric-card');
                card.appendChild(createElement('div', 'value', metric.value));
                card.appendChild(createElement('div', 'label', metric.label));
                card.appendChild(createElement('div', 'interpretation', metric.interpretation));
                metricsGrid.appendChild(card);
            });
            execSection.appendChild(metricsGrid);
            
            if (reportData.executive.snapshot) {
                const snapshotDiv = createElement('div', 'snapshot-details');
                if(reportData.executive.snapshot.strengths?.length) snapshotDiv.innerHTML += `<h3>Key Strengths:</h3><ul>${reportData.executive.snapshot.strengths.map(s => `<li>${s}</li>`).join('')}</ul>`;
                if(reportData.executive.snapshot.gaps?.length) snapshotDiv.innerHTML += `<h3>Areas for Focus:</h3><ul>${reportData.executive.snapshot.gaps.map(g => `<li>${g}</li>`).join('')}</ul>`;
                if(reportData.executive.snapshot.quickestWin) snapshotDiv.innerHTML += `<h3>Quickest Win:</h3><p><strong>${reportData.executive.snapshot.quickestWin.action}</strong> (Impact: ${reportData.executive.snapshot.quickestWin.impact}, Effort: ${reportData.executive.snapshot.quickestWin.effort})</p>`;
                execSection.appendChild(snapshotDiv);
            }

            const narrativeDiv = createElement('div', 'narrative');
            narrativeDiv.appendChild(createPara(reportData.executive.narrative));
            execSection.appendChild(narrativeDiv);
            container.appendChild(execSection);

            // 2. Readiness Section
            const readinessSection = createElement('div', 'report-section readiness-deep-dive');
            readinessSection.appendChild(createHeader(2, "Readiness Deep Dive"));
            readinessSection.appendChild(createPara(`Overall AI Readiness Score: <strong>${reportData.readiness.overall.score}/100</strong> (${reportData.readiness.overall.categoryLabel})`));
            
            const dimsGrid = createElement('div', 'readiness-dimensions-grid');
            reportData.readiness.dimensions.forEach(dim => {
                const card = createElement('div', 'dimension-card');
                card.innerHTML = `<div class="name">${dim.name}</div><div class="score">${dim.score}</div><p class="description">${dim.description}</p>`;
                dimsGrid.appendChild(card);
            });
            readinessSection.appendChild(dimsGrid);

            if (reportData.readiness.serviceOrActivityReadiness?.length) {
                readinessSection.appendChild(createHeader(3, assessmentType === 'agency' ? "Service Line Readiness" : "Marketing Activity Readiness"));
                const ul = createElement('ul');
                reportData.readiness.serviceOrActivityReadiness.forEach(item => {
                    const li = createElement('li', null, `${item.name}: Score ${item.score}/100. ${item.interpretation}`);
                    ul.appendChild(li);
                });
                readinessSection.appendChild(ul);
            }
            readinessSection.appendChild(createHeader(3, "Champions & Barriers"));
            readinessSection.appendChild(createPara(`Potential Champions: ${reportData.readiness.champions}`));
            readinessSection.appendChild(createPara(`Key Barriers: ${reportData.readiness.barriers}`));
            container.appendChild(readinessSection);

            // 3. Opportunities Section
            const oppSection = createElement('div', 'report-section opportunities');
            oppSection.appendChild(createHeader(2, "Your Transformation Opportunities"));
            ['immediate', 'shortTerm', 'transformational'].forEach(key => {
                if (reportData.opportunities[key]?.items?.length) {
                    oppSection.appendChild(createHeader(3, reportData.opportunities[key].title));
                    oppSection.appendChild(createPara(reportData.opportunities[key].subtitle));
                    reportData.opportunities[key].items.forEach(item => {
                        const itemEl = createElement('div', 'recommendation-item');
                        itemEl.innerHTML = `<h4 class="title">${item.title}</h4><p class="description">${item.description || item}</p>`;
                        if(typeof item === 'object' && item.effort) itemEl.innerHTML += `<div class="details"><strong>Effort:</strong> ${item.effort} | <strong>Impact:</strong> ${item.impact || item.roi}</div>`;
                        oppSection.appendChild(itemEl);
                    });
                }
            });
            container.appendChild(oppSection);

            // 4. Roadmap Section
            const roadmapSection = createElement('div', 'report-section roadmap');
            roadmapSection.appendChild(createHeader(2, reportData.roadmap.overview.title || "Transformation Roadmap"));
            roadmapSection.appendChild(createPara(reportData.roadmap.overview.approach));
            reportData.roadmap.phases.forEach(phase => {
                const phaseEl = createElement('div', 'roadmap-phase');
                phaseEl.innerHTML = `<h4 class="phase-title">${phase.title} (${phase.duration})</h4><p><strong>Focus:</strong> ${phase.focus}</p><strong>Actions/Milestones:</strong><ul>${(phase.actions || []).map(action => `<li>${typeof action === 'string' ? action : action.title}</li>`).join('')}</ul><p><strong>Expected Outcome:</strong> ${phase.outcome}</p>`;
                roadmapSection.appendChild(phaseEl);
            });
            if(reportData.roadmap.investmentGuide) roadmapSection.appendChild(createPara(`<strong>Suggested Investment:</strong> ${reportData.roadmap.investmentGuide}`));
            container.appendChild(roadmapSection);
            
            // 5. Impact Section
            const impactSection = createElement('div', 'report-section impact-analysis');
            impactSection.appendChild(createHeader(2, reportData.impact.title));
            impactSection.appendChild(createPara(reportData.impact.subtitle));

            if (assessmentType === 'agency') {
                const valGrid = createElement('div', 'valuation-grid');
                const currentCard = createElement('div', 'valuation-card');
                currentCard.innerHTML = `<div class="label">Current Estimated Multiple</div><div class="value">${reportData.impact.current.multiple}</div><p>${reportData.impact.current.category}</p>`;
                const potentialCard = createElement('div', 'valuation-card');
                potentialCard.innerHTML = `<div class="label">Potential Multiple (with AI)</div><div class="value">${reportData.impact.potential.multiple}</div><div class="increase">${reportData.impact.potential.increase}</div><p>Achievable in ${reportData.impact.potential.achievableIn}</p>`;
                valGrid.appendChild(currentCard); 
                valGrid.appendChild(potentialCard);
                impactSection.appendChild(valGrid);
                impactSection.appendChild(createHeader(3, "Key Value Drivers"));
                const driversUl = createElement('ul', 'valuation-drivers-list');
                reportData.impact.drivers.forEach(driver => driversUl.innerHTML += `<li><strong>${driver.driver}:</strong> ${driver.action} (Potential: ${driver.potentialImpact})</li>`);
                impactSection.appendChild(driversUl);
                if(reportData.impact.risks?.length) {
                    impactSection.appendChild(createHeader(3, "Valuation Risks to Address"));
                    const risksUl = createElement('ul');
                    reportData.impact.risks.forEach(risk => risksUl.innerHTML += `<li><strong>${risk.factor} (${risk.severity}):</strong> ${risk.description}. Mitigation: ${risk.mitigation}</li>`);
                    impactSection.appendChild(risksUl);
                }
            } else {
                impactSection.appendChild(createHeader(3, reportData.impact.headline));
                if(reportData.impact.details) {
                    impactSection.innerHTML += `<p><strong>Time Savings:</strong> ${reportData.impact.details.timeSavings}</p>`;
                    impactSection.innerHTML += `<p><strong>Output Increase:</strong> ${reportData.impact.details.outputIncrease}</p>`;
                }
                if(reportData.impact.timeline) impactSection.innerHTML += `<p><strong>Timeline:</strong> Month 1: ${reportData.impact.timeline.month1}, Month 3: ${reportData.impact.timeline.month3}</p>`;
                impactSection.appendChild(createPara(`<strong>Projected ROI:</strong> ${reportData.impact.roi}`));
            }
            container.appendChild(impactSection);

            // 6. Next Steps Section
            const nextStepsSection = createElement('div', 'report-section next-steps');
            nextStepsSection.appendChild(createHeader(2, "Your Next Steps"));
            const urgencyEl = createElement('div', `urgency-banner ${reportData.nextSteps.urgency.level}`);
            urgencyEl.style.backgroundColor = reportData.nextSteps.urgency.color || 'rgba(255,255,102,0.1)';
            urgencyEl.style.padding = '1rem';
            urgencyEl.style.borderRadius = '8px';
            urgencyEl.style.marginBottom = '1.5rem';
            urgencyEl.innerHTML = `<h4 style="color: #141414; margin-bottom:0.25rem;">${reportData.nextSteps.urgency.level.toUpperCase()} URGENCY</h4><p style="color: #141414; margin-bottom:0;">${reportData.nextSteps.urgency.message}</p>`;
            nextStepsSection.appendChild(urgencyEl);

            const ctaPrimary = reportData.nextSteps.primaryCTA;
            const primaryCtaDiv = createElement('div', 'primary-cta-block');
            primaryCtaDiv.style.textAlign = 'center';
            primaryCtaDiv.style.marginBottom = '2rem';
            primaryCtaDiv.innerHTML = `<h3>${ctaPrimary.headline}</h3><p>${ctaPrimary.subheadline}</p>`;
            const primaryBtn = createElement('button', 'btn btn-primary cta-button');
            primaryBtn.textContent = ctaPrimary.buttonText;
            primaryBtn.onclick = () => window.bookConsultation(assessmentType);
            primaryCtaDiv.appendChild(primaryBtn);
            nextStepsSection.appendChild(primaryCtaDiv);
            
            nextStepsSection.appendChild(createHeader(3, "Choose Your Path Forward:"));
            const optionsGrid = createElement('div', 'next-steps-options');
            reportData.nextSteps.options.forEach(opt => {
                const card = createElement('div', 'next-step-card');
                card.innerHTML = `<h4 class="title">${opt.title}</h4><p class="price">${opt.price}</p><p>${opt.description}</p><p><small><em>Ideal for: ${opt.idealFor}</em></small></p>`;
                const btn = createElement('button', 'btn btn-secondary cta-button');
                btn.textContent = opt.price === "Free" ? "Access Resources" : "Learn More";
                btn.onclick = () => alert(`Learn more about: ${opt.title}`);
                card.appendChild(btn);
                optionsGrid.appendChild(card);
            });
            nextStepsSection.appendChild(optionsGrid);

            if (reportData.nextSteps.testimonial) {
                nextStepsSection.appendChild(createHeader(3, "What Our Clients Say:"));
                const testimonialDiv = createElement('div', 'testimonial');
                testimonialDiv.innerHTML = `<blockquote class="testimonial-quote">"${reportData.nextSteps.testimonial.quote}"</blockquote><p class="testimonial-author">- ${reportData.nextSteps.testimonial.author}</p>`;
                nextStepsSection.appendChild(testimonialDiv);
            }
            container.appendChild(nextStepsSection);
        }

        window.bookConsultation = function(type) {
            alert(`Booking QuickMap.ai Consultation for ${type}!`);
            // In production, this would link to a booking system
        };

        // --- URL Parameter Support ---
        function handleUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const directAssessmentType = urlParams.get('type');
            if (directAssessmentType && ['agency', 'inhouse'].includes(directAssessmentType)) {
                window.selectAssessment(directAssessmentType);
            }
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Check for saved progress
            if (loadProgress()) {
                window.showScreen(window.userData.currentScreenId);
                console.log('Restored previous session');
            } else {
                handleUrlParameters();
                window.showScreen(window.userData.currentScreenId);
            }
        });
    </script>
</body>
</html>